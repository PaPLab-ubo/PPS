<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Management Dashboard - Futuristic</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --main-green: #00ff88;
            --light-green: #00ff8820;
            --dark-grey: #1a1a1a;
            --border-color: #333333;
            --blue-accent: #00a8ff;
            --warning: #ffaa00;
            --danger: #ff5555;
            --card-bg: #2a2a2a;
            --future-blue: #667eea;
            --future-purple: #764ba2;
            --neon-pink: #ff00ff;
            --neon-cyan: #00ffff;
            --dark-bg: #121212;
            --glass-bg: rgba(30, 30, 30, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --purple-dot: #9b59b6;
            --agro-green: #27ae60;
            --esp-blue: #3498db;
            color-scheme: dark;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1a1a2e 100%);
            margin: 0;
            padding: 20px;
            color: #ffffff;
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1800px;
            margin: 0 auto;
            background: var(--glass-bg);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--main-green);
            flex-wrap: wrap;
            gap: 15px;
        }

        h1 {
            background: linear-gradient(45deg, var(--main-green), var(--neon-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin: 0;
            font-size: 24px;
            font-weight: 800;
        }

        .header-controls {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 18px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--main-green), #00cc66);
            border: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--blue-accent), #0097e6);
            border: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #ff3333);
            border: none;
        }

        .btn-purple {
            background: linear-gradient(135deg, var(--future-purple), #9b59b6);
            border: none;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #ff8800);
            border: none;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--agro-green), #2ecc71);
            border: none;
        }

        .btn-pdf {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            border: none;
        }

        .filter-select {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
            background: var(--glass-bg);
            font-weight: 500;
            font-size: 14px;
            color: white;
            min-width: 180px;
        }

        /* Optimized Layout */
        .dashboard-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .main-section {
            display: grid;
            grid-template-rows: auto 1fr;
            gap: 20px;
        }

        /* KPI Cards - Interactive - Updated for mobile responsiveness */
        .kpi-row {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .kpi-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            padding: 15px;
            border-radius: 12px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            min-height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            cursor: pointer;
        }

        .kpi-card:hover {
            transform: translateY(-3px);
            border-color: var(--main-green);
            box-shadow: 0 10px 25px rgba(0, 255, 136, 0.1);
        }

        .kpi-card.clicked {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            border-color: var(--future-purple);
        }

        .kpi-card h3 {
            font-size: 11px;
            margin: 0 0 8px 0;
            color: #888;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kpi-card .kpi-value {
            font-size: 24px;
            font-weight: 800;
            margin: 5px 0;
            background: linear-gradient(45deg, var(--main-green), var(--neon-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .kpi-card .kpi-change {
            font-size: 10px;
            color: #aaa;
        }

        /* Section Boxes - Uniform Size */
        .section-box {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s;
            height: 420px;
            display: flex;
            flex-direction: column;
        }

        .section-title {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8));
            color: white;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--glass-border);
            flex-shrink: 0;
        }

        .section-title .section-actions {
            display: flex;
            gap: 8px;
        }

        .section-title .action-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 6px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s;
        }

        .section-title .action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Table Container - Optimized */
        .table-container {
            padding: 15px;
            overflow: auto;
            flex: 1;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        th {
            background: rgba(255, 255, 255, 0.05);
            color: #ccc;
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--glass-border);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        td {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 12px;
            color: #ddd;
            white-space: nowrap;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .project-name-link {
            color: var(--blue-accent);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .project-name-link:hover {
            color: var(--neon-cyan);
            text-decoration: underline;
        }

        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .status-running {
            background: rgba(0, 255, 136, 0.1);
            color: var(--main-green);
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .status-upcoming {
            background: rgba(255, 170, 0, 0.1);
            color: var(--warning);
            border: 1px solid rgba(255, 170, 0, 0.3);
        }

        .status-completed {
            background: rgba(0, 255, 136, 0.2);
            color: var(--main-green);
            border: 1px solid rgba(0, 255, 136, 0.5);
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 8px;
            width: 100%;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--main-green), var(--neon-cyan));
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* CALENDAR - Updated for 100px */
        .calendar-container {
            padding: 15px;
            overflow: auto;
            flex: 1;
            width: 100%;
            height: 100px;
            display: flex;
            align-items: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }

        .cal-day-header {
            background: rgba(102, 126, 234, 0.3);
            padding: 4px;
            text-align: center;
            font-weight: 600;
            font-size: 9px;
            color: #ddd;
            border-bottom: 1px solid var(--glass-border);
        }

        .cal-day {
            background: rgba(255, 255, 255, 0.03);
            padding: 2px;
            font-size: 10px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 0;
        }

        .cal-day:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .cal-day.today {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--main-green);
        }

        .cal-day.has-event {
            background: rgba(255, 255, 255, 0.05);
        }

        .cal-day .event-dot {
            width: 6px;
            height: 6px;
            background-color: var(--purple-dot);
            border-radius: 50%;
            position: absolute;
            bottom: 2px;
            right: 2px;
        }

        /* IMPROVED Habit Tracker */
        .habit-tracker-container {
            margin-top: 20px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            overflow: hidden;
        }

        .habit-tracker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            border-bottom: 1px solid var(--glass-border);
            flex-wrap: wrap;
            gap: 10px;
        }

        .habit-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .habit-month-display {
            font-size: 16px;
            font-weight: 700;
            background: linear-gradient(45deg, var(--future-blue), var(--future-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* IMPROVED Habit Grid */
        .improved-habit-grid {
            display: grid;
            grid-template-columns: 200px repeat(31, 35px);
            overflow-x: auto;
            font-size: 12px;
            border-top: 1px solid var(--glass-border);
            max-height: 400px;
            overflow-y: auto;
        }

        .habit-cell {
            padding: 8px 5px;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 40px;
            transition: all 0.2s;
        }

        .habit-cell.header {
            background: rgba(102, 126, 234, 0.2);
            font-weight: 600;
            color: #ddd;
            font-size: 11px;
            text-transform: uppercase;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .habit-cell.task-name {
            background: rgba(30, 30, 30, 0.9);
            justify-content: flex-start;
            font-size: 12px;
            position: sticky;
            left: 0;
            z-index: 20;
            border-right: 2px solid var(--glass-border);
            gap: 8px;
            cursor: pointer;
        }

        .habit-cell.task-name:hover {
            background: rgba(50, 50, 50, 0.9);
        }

        .habit-cell.day {
            position: relative;
            cursor: pointer;
            padding: 2px;
        }

        .habit-cell.day:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .habit-cell.day.completed {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.3), rgba(0, 200, 100, 0.3));
            border: 1px solid rgba(0, 255, 136, 0.5);
        }

        .day-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--glass-border);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            background: rgba(255, 255, 255, 0.05);
        }

        .day-checkbox.checked {
            background: var(--main-green);
            border-color: var(--main-green);
            transform: scale(1.1);
        }

        .day-checkbox:hover {
            border-color: var(--main-green);
            transform: scale(1.05);
        }

        .day-checkbox i {
            font-size: 12px;
            color: white;
        }

        /* Project badge in habit tracker */
        .project-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 9px;
            background: rgba(102, 126, 234, 0.3);
            color: #a0b0ff;
            margin-left: 5px;
        }

        /* Monthly Stats - Interactive */
        .monthly-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            padding: 15px;
            border-top: 1px solid var(--glass-border);
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .stat-card:hover {
            border-color: var(--main-green);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 255, 136, 0.1);
        }

        .stat-card.active {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            border-color: var(--future-purple);
        }

        .stat-value {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 4px;
            background: linear-gradient(45deg, var(--main-green), var(--neon-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 10px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--glass-bg);
            padding: 25px;
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 25px 75px rgba(0, 0, 0, 0.7);
            border: 1px solid var(--glass-border);
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-large {
            max-width: 1200px;
        }

        .modal-extra-large {
            max-width: 95%;
            max-height: 95vh;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 13px;
            color: #ddd;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--main-green);
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1);
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 25px;
        }

        /* Dashboard charts layout */
        .dashboard-charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid var(--glass-border);
            height: 300px;
            position: relative;
        }

        .chart-container canvas {
            width: 100% !important;
            height: 100% !important;
        }

        .chart-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--main-green);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Project metrics grid */
        .project-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s;
        }

        .metric-card:hover {
            border-color: var(--main-green);
            transform: translateY(-2px);
        }

        .metric-card h4 {
            margin: 0 0 10px 0;
            color: var(--neon-cyan);
            font-size: 13px;
        }

        .metric-card .metric-value {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 5px;
            background: linear-gradient(45deg, var(--main-green), var(--neon-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .metric-card .metric-label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Project details in dashboard */
        .project-details-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--glass-border);
        }

        .project-details-panel h3 {
            color: var(--future-purple);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 16px;
        }

        /* Task list in calendar modal */
        .task-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 15px 0;
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
        }

        .task-item {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .task-item:hover {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
        }

        .task-item:last-child {
            border-bottom: none;
        }

        /* Time tracking styles */
        .time-track-btn {
            background: rgba(0, 168, 255, 0.1);
            border: 1px solid rgba(0, 168, 255, 0.3);
            color: var(--blue-accent);
            padding: 5px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s;
        }

        .time-track-btn:hover {
            background: rgba(0, 168, 255, 0.2);
            transform: translateY(-1px);
        }

        /* Completion button */
        .complete-btn {
            background: linear-gradient(135deg, var(--main-green), #00cc66);
            border: none;
            color: white;
            padding: 5px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .complete-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.2);
        }

        .complete-btn.completed {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        /* Category tags */
        .category-tag {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .category-agro {
            background: rgba(39, 174, 96, 0.2);
            color: var(--agro-green);
            border: 1px solid rgba(39, 174, 96, 0.3);
        }

        .category-esp {
            background: rgba(52, 152, 219, 0.2);
            color: var(--esp-blue);
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        .category-custom {
            background: rgba(155, 89, 182, 0.2);
            color: var(--purple-dot);
            border: 1px solid rgba(155, 89, 182, 0.3);
        }

        /* AI Suggestions */
        .ai-suggestion {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-left: 4px solid var(--future-purple);
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }

        .ai-suggestion h4 {
            margin: 0 0 8px 0;
            color: var(--future-purple);
            font-size: 13px;
        }

        .ai-suggestion p {
            margin: 0;
            color: #ccc;
            font-size: 12px;
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .dashboard-content {
                grid-template-columns: 1fr;
            }
            
            .kpi-row {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .section-box {
                height: 400px;
            }
            
            .dashboard-charts-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .kpi-row {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .header-controls {
                width: 100%;
            }
            
            .filter-select {
                min-width: 150px;
            }
            
            .improved-habit-grid {
                grid-template-columns: 150px repeat(31, 30px);
                font-size: 10px;
            }
            
            .habit-cell {
                padding: 6px 3px;
                min-height: 35px;
            }
            
            .monthly-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .calendar-container {
                height: 120px;
            }
            
            .project-metrics-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .kpi-row {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
            
            body {
                padding: 10px;
            }
            
            .dashboard-container {
                padding: 15px;
            }
            
            .improved-habit-grid {
                grid-template-columns: 120px repeat(31, 25px);
            }
            
            .monthly-stats {
                grid-template-columns: 1fr;
            }
            
            .calendar-container {
                height: 140px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--main-green), var(--neon-cyan));
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--future-blue), var(--future-purple));
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--main-green);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--future-blue), var(--future-purple));
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
            max-width: 400px;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            to { opacity: 0; transform: translateY(10px); }
        }

        /* Tabs in modal */
        .modal-tabs {
            display: flex;
            border-bottom: 1px solid var(--glass-border);
            margin-bottom: 20px;
        }

        .modal-tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            color: #aaa;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .modal-tab.active {
            color: var(--main-green);
            border-bottom: 3px solid var(--main-green);
        }

        .modal-tab:hover:not(.active) {
            color: #ddd;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>

<div class="dashboard-container">
    <!-- Header with new Dashboard button -->
    <div class="dashboard-header">
        <div>
            <h1><i class="fas fa-project-diagram"></i> PROJECT MANAGEMENT DASHBOARD</h1>
            <p style="color: #aaa; margin-top: 5px; font-size: 13px;">Pregled projekata i habit tracker - 2026</p>
        </div>
        <div class="header-controls">
            <select class="filter-select" id="projectFilter">
                <option value="all">Svi projekti</option>
                <option value="running">Aktivni</option>
                <option value="upcoming">Nadolazeći</option>
                <option value="completed">Završeni</option>
            </select>
            <button class="btn btn-purple" id="dashboardBtn">
                <i class="fas fa-chart-bar"></i> Dashboard
            </button>
            <button class="btn btn-secondary" id="addProjectBtn">
                <i class="fas fa-plus"></i> Novi projekt
            </button>
            <button class="btn btn-primary" id="exportExcel">
                <i class="fas fa-file-excel"></i> Excel
            </button>
            <button class="btn btn-pdf" id="exportPdf">
                <i class="fas fa-file-pdf"></i> PDF
            </button>
            <button class="btn btn-danger" id="clearAll">
                <i class="fas fa-trash-alt"></i> Clear All
            </button>
        </div>
    </div>

    <!-- KPI Cards - Interactive -->
    <div class="kpi-row">
        <div class="kpi-card" id="kpiTotalProjects">
            <h3>Ukupno projekata</h3>
            <div class="kpi-value" id="totalProjects">0</div>
            <div class="kpi-change">+0 od prošlog mjeseca</div>
        </div>
        <div class="kpi-card" id="kpiRunningProjects">
            <h3>Aktivni projekti</h3>
            <div class="kpi-value" id="runningProjects">0</div>
            <div class="kpi-change">Trenutno u izvršenju</div>
        </div>
        <div class="kpi-card" id="kpiActiveTasks">
            <h3>Aktivni zadaci</h3>
            <div class="kpi-value" id="inProgress">0</div>
            <div class="kpi-change">Podprojekti u toku</div>
        </div>
        <div class="kpi-card" id="kpiTimeSpent">
            <h3>Utrošeno vrijeme</h3>
            <div class="kpi-value" id="timeSpent">0h</div>
            <div class="kpi-change">Ukupno za sve projekte</div>
        </div>
        <div class="kpi-card" id="kpiAvgTime">
            <h3>Prosječno vrijeme</h3>
            <div class="kpi-value" id="avgTime">0h</div>
            <div class="kpi-change">Po projektu</div>
        </div>
        <div class="kpi-card" id="kpiWeeklyProgress">
            <h3>Sedmični napredak</h3>
            <div class="kpi-value" id="weeklyProgress">0%</div>
            <div class="kpi-change">Ova sedmica</div>
        </div>
    </div>

    <!-- Main Content - Calendar and Projects -->
    <div class="dashboard-content">
        <!-- Project Overview -->
        <div class="main-section">
            <div class="section-box">
                <div class="section-title">
                    <span><i class="fas fa-table"></i> PREGLED PROJEKATA</span>
                    <div class="section-actions">
                        <button class="action-btn" id="sortByDate" title="Sortiraj po datumu">
                            <i class="fas fa-calendar-alt"></i>
                        </button>
                        <button class="action-btn" id="sortByProgress" title="Sortiraj po napretku">
                            <i class="fas fa-sort-amount-up"></i>
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="projectsTable">
                        <thead>
                            <tr>
                                <th>Projekt</th>
                                <th>Kategorija</th>
                                <th>Početak</th>
                                <th>Završetak</th>
                                <th>Napredak</th>
                                <th>Utrošeno vrijeme</th>
                                <th>Status</th>
                                <th>Akcije</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Projects will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Calendar - Fixed 100px -->
        <div class="main-section">
            <div class="section-box">
                <div class="section-title">
                    <span><i class="fas fa-calendar-alt"></i> KALENDAR - <span id="currentMonthYear">JANUAR 2026</span></span>
                    <div class="section-actions">
                        <button class="action-btn" id="prevMonth" title="Prethodni mjesec">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="action-btn" id="nextMonth" title="Sljedeći mjesec">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div class="calendar-container">
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- IMPROVED Habit Tracker -->
    <div class="habit-tracker-container">
        <div class="habit-tracker-header">
            <div class="habit-controls">
                <select class="filter-select" id="habitProjectFilter" style="width: 180px;">
                    <option value="all">Svi projekti</option>
                    <!-- Project options will be populated by JavaScript -->
                </select>
                
                <select class="filter-select" id="habitMonthSelect" style="width: 120px;">
                    <option value="0">Januar</option>
                    <option value="1">Februar</option>
                    <option value="2">Mart</option>
                    <option value="3">April</option>
                    <option value="4">Maj</option>
                    <option value="5">Juni</option>
                    <option value="6">Juli</option>
                    <option value="7">Avgust</option>
                    <option value="8">Septembar</option>
                    <option value="9">Oktobar</option>
                    <option value="10">Novembar</option>
                    <option value="11">Decembar</option>
                </select>
                
                <select class="filter-select" id="habitYearSelect" style="width: 100px;">
                    <option>2024</option>
                    <option>2025</option>
                    <option selected>2026</option>
                    <option>2027</option>
                </select>
                
                <input type="text" class="form-control" id="newHabitTask" 
                       placeholder="Novi zadatak..." 
                       style="width: 180px; padding: 8px;"
                       onkeypress="if(event.key === 'Enter') addHabitTask()">
                
                <button class="btn btn-purple" onclick="addHabitTask()" style="padding: 8px 12px;">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            
            <div class="habit-month-display" id="habitMonthDisplay">
                Januar 2026
            </div>
        </div>
        
        <!-- Improved Habit Grid -->
        <div class="improved-habit-grid" id="improvedHabitGrid">
            <!-- Habit grid will be populated by JavaScript -->
        </div>
        
        <!-- Monthly Stats - Interactive -->
        <div class="monthly-stats">
            <div class="stat-card" id="statMonthlyCompletion">
                <div class="stat-value" id="monthlyCompletion">0%</div>
                <div class="stat-label">MJESEČNI PROGRES</div>
            </div>
            <div class="stat-card" id="statTotalTasks">
                <div class="stat-value" id="totalTasks">0</div>
                <div class="stat-label">UKUPNO ZADATAKA</div>
            </div>
            <div class="stat-card" id="statCompletedDays">
                <div class="stat-value" id="completedDays">0</div>
                <div class="stat-label">DANA U REDU</div>
            </div>
            <div class="stat-card" id="statConsistency">
                <div class="stat-value" id="consistency">0%</div>
                <div class="stat-label">KONZISTENTNOST</div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--glass-border); text-align: center; color: #777; font-size: 12px;">
        <p><strong>Project Management Dashboard v3.0</strong> • AI Enhanced • Grafikoni u realnom vremenu • Ažurirano: <span id="currentDate"></span></p>
    </div>
</div>

<!-- Modal for adding/editing project -->
<div class="modal" id="projectModal">
    <div class="modal-content">
        <h2 style="margin-top: 0; color: var(--main-green);"><i class="fas fa-plus-circle"></i> <span id="modalProjectTitle">Novi projekt</span></h2>
        
        <div class="modal-tabs">
            <div class="modal-tab active" data-tab="basic">Osnovne informacije</div>
            <div class="modal-tab" data-tab="metrics">Metrike i grafikoni</div>
            <div class="modal-tab" data-tab="advanced">Napredne postavke</div>
        </div>
        
        <form id="projectForm">
            <input type="hidden" id="projectId" value="">
            
            <!-- Basic Info Tab -->
            <div class="tab-content active" id="basicTab">
                <div class="form-group">
                    <label for="projectName">Naziv projekta *</label>
                    <input type="text" id="projectName" class="form-control" required placeholder="Unesite naziv projekta">
                </div>
                <div class="form-group">
                    <label for="projectDescription">Opis projekta</label>
                    <textarea id="projectDescription" class="form-control" rows="3" placeholder="Unesite opis projekta"></textarea>
                </div>
                <div class="form-group">
                    <label for="projectCategory">Kategorija *</label>
                    <input type="text" id="projectCategory" class="form-control" required 
                           placeholder="Unesite kategoriju (AGRO, ESP ili vlastitu)"
                           list="categorySuggestions">
                    <datalist id="categorySuggestions">
                        <option value="AGRO">
                        <option value="ESP">
                        <option value="Posao">
                        <option value="Osobni">
                        <option value="Edukacija">
                        <option value="Zdravlje">
                        <option value="Financije">
                        <option value="Privatni posao i zdravlje">
                    </datalist>
                    <div style="margin-top: 8px;">
                        <small style="color: #888;">Preporučene kategorije: 
                            <span class="category-tag category-agro">AGRO</span>
                            <span class="category-tag category-esp">ESP</span>
                            <span class="category-tag">Posao</span>
                            <span class="category-tag">Osobni</span>
                        </small>
                    </div>
                </div>
                <div class="form-group">
                    <label for="projectStart">Datum i vrijeme početka *</label>
                    <input type="datetime-local" id="projectStart" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="projectEnd">Datum i vrijeme završetka *</label>
                    <input type="datetime-local" id="projectEnd" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="projectProgress">Početni napredak (%)</label>
                    <input type="range" id="projectProgress" class="form-control" min="0" max="100" value="0">
                    <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                        <span>0%</span>
                        <span id="progressValue">0%</span>
                        <span>100%</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="projectStatus">Status</label>
                    <select id="projectStatus" class="form-control">
                        <option value="running">Aktivan</option>
                        <option value="upcoming">Nadolazeći</option>
                        <option value="completed">Završen</option>
                    </select>
                </div>
            </div>
            
            <!-- Metrics Tab -->
            <div class="tab-content" id="metricsTab">
                <div class="form-group">
                    <label for="projectBudget">Budžet (€)</label>
                    <input type="number" id="projectBudget" class="form-control" min="0" step="100" placeholder="Unesite budžet projekta">
                </div>
                <div class="form-group">
                    <label for="projectTeamSize">Broj članova tima</label>
                    <input type="number" id="projectTeamSize" class="form-control" min="1" max="100" placeholder="Unesite broj članova tima">
                </div>
                <div class="form-group">
                    <label for="projectPriority">Prioritet</label>
                    <select id="projectPriority" class="form-control">
                        <option value="low">Nizak</option>
                        <option value="medium" selected>Srednji</option>
                        <option value="high">Visok</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="projectRiskLevel">Nivo rizika</label>
                    <select id="projectRiskLevel" class="form-control">
                        <option value="low">Nizak</option>
                        <option value="medium" selected>Srednji</option>
                        <option value="high">Visok</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="projectSatisfaction">Zadovoljstvo klijenta (1-10)</label>
                    <input type="range" id="projectSatisfaction" class="form-control" min="1" max="10" value="5">
                    <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                        <span>1</span>
                        <span id="satisfactionValue">5</span>
                        <span>10</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="projectComplexity">Kompleksnost projekta (1-10)</label>
                    <input type="range" id="projectComplexity" class="form-control" min="1" max="10" value="5">
                    <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                        <span>1</span>
                        <span id="complexityValue">5</span>
                        <span>10</span>
                    </div>
                </div>
            </div>
            
            <!-- Advanced Tab -->
            <div class="tab-content" id="advancedTab">
                <div class="form-group">
                    <label for="projectTags">Tagovi (odvojite zarezom)</label>
                    <input type="text" id="projectTags" class="form-control" placeholder="npr. web, mobilni, AI, database">
                </div>
                <div class="form-group">
                    <label for="projectClient">Klijent</label>
                    <input type="text" id="projectClient" class="form-control" placeholder="Unesite ime klijenta">
                </div>
                <div class="form-group">
                    <label for="projectStakeholders">Stakeholderi (odvojite zarezom)</label>
                    <input type="text" id="projectStakeholders" class="form-control" placeholder="Unesite imena stakeholder-a">
                </div>
                <div class="form-group">
                    <label for="projectDependencies">Zavisnosti od drugih projekata</label>
                    <select id="projectDependencies" class="form-control" multiple style="height: 100px;">
                        <!-- Options will be populated by JavaScript -->
                    </select>
                    <small style="color: #888;">Držite Ctrl za višestruki odabir</small>
                </div>
                <div class="form-group">
                    <label for="projectTechnology">Tehnologije</label>
                    <input type="text" id="projectTechnology" class="form-control" placeholder="Unesite korištene tehnologije">
                </div>
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn" style="background: rgba(255, 255, 255, 0.1);" id="cancelProject">Odustani</button>
                <button type="submit" class="btn btn-primary" id="submitProjectBtn">Dodaj projekt</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal for Dashboard with Charts -->
<div class="modal" id="dashboardModal">
    <div class="modal-content modal-extra-large">
        <h2 style="margin-top: 0; color: var(--future-purple);"><i class="fas fa-chart-bar"></i> DASHBOARD - Grafički prikazi projekata</h2>
        
        <div class="modal-tabs">
            <div class="modal-tab active" data-tab="overview">Pregled</div>
            <div class="modal-tab" data-tab="detailed">Detaljni grafikoni</div>
            <div class="modal-tab" data-tab="comparison">Komparativna analiza</div>
        </div>
        
        <!-- Overview Tab -->
        <div class="tab-content active" id="overviewTab">
            <div class="dashboard-charts-container">
                <div class="chart-container">
                    <div class="chart-title"><i class="fas fa-chart-pie"></i> Projekti po kategorijama</div>
                    <canvas id="donutChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title"><i class="fas fa-chart-line"></i> Napredak projekata</div>
                    <canvas id="lineChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title"><i class="fas fa-chart-bar"></i> Vrijeme po projektima</div>
                    <canvas id="barChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title"><i class="fas fa-bullseye"></i> Status projekata</div>
                    <canvas id="radarChart"></canvas>
                </div>
            </div>
            
            <!-- Project Metrics Summary -->
            <div class="project-metrics-grid">
                <div class="metric-card">
                    <h4>Ukupna vrijednost projekata</h4>
                    <div class="metric-value" id="dashboardTotalBudget">0 €</div>
                    <div class="metric-label">SUMA BUDŽETA</div>
                </div>
                <div class="metric-card">
                    <h4>Prosječno vrijeme po projektu</h4>
                    <div class="metric-value" id="dashboardAvgTime">0h</div>
                    <div class="metric-label">SATI / PROJEKT</div>
                </div>
                <div class="metric-card">
                    <h4>Ukupni tim</h4>
                    <div class="metric-value" id="dashboardTotalTeam">0</div>
                    <div class="metric-label">UKUPNO ČLANOVA</div>
                </div>
                <div class="metric-card">
                    <h4>Prosječna kompleksnost</h4>
                    <div class="metric-value" id="dashboardAvgComplexity">0</div>
                    <div class="metric-label">SKALA 1-10</div>
                </div>
            </div>
        </div>
        
        <!-- Detailed Charts Tab -->
        <div class="tab-content" id="detailedTab">
            <div class="dashboard-charts-container">
                <div class="chart-container">
                    <div class="chart-title"><i class="fas fa-chart-area"></i> Vrijeme po mjesecima</div>
                    <canvas id="areaChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title"><i class="fas fa-balance-scale"></i> Budžet vs Vrijeme</div>
                    <canvas id="scatterChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title"><i class="fas fa-chart-pie"></i> Projekti po prioritetu</div>
                    <canvas id="pieChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title"><i class="fas fa-tachometer-alt"></i> Zadovoljstvo klijenta</div>
                    <canvas id="gaugeChart"></canvas>
                </div>
            </div>
            
            <!-- Project List with Details -->
            <div class="project-details-panel">
                <h3><i class="fas fa-list-ul"></i> Projekti sa metrikama</h3>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; font-size: 12px;">
                        <thead>
                            <tr>
                                <th>Projekt</th>
                                <th>Kategorija</th>
                                <th>Budžet</th>
                                <th>Tim</th>
                                <th>Prioritet</th>
                                <th>Rizik</th>
                                <th>Zadovoljstvo</th>
                                <th>Kompleksnost</th>
                            </tr>
                        </thead>
                        <tbody id="dashboardProjectsTable">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Comparison Tab -->
        <div class="tab-content" id="comparisonTab">
            <div style="margin-bottom: 20px;">
                <label for="compareProject1" style="color: #ddd; font-size: 14px; margin-right: 10px;">Odaberi projekte za poređenje:</label>
                <select id="compareProject1" class="form-control" style="width: 200px; display: inline-block;">
                    <option value="">Odaberi projekt 1</option>
                </select>
                <select id="compareProject2" class="form-control" style="width: 200px; display: inline-block; margin-left: 10px;">
                    <option value="">Odaberi projekt 2</option>
                </select>
                <button class="btn btn-primary" onclick="compareProjects()" style="margin-left: 10px;">
                    <i class="fas fa-balance-scale"></i> Uporedi
                </button>
            </div>
            
            <div class="dashboard-charts-container">
                <div class="chart-container">
                    <div class="chart-title"><i class="fas fa-chart-bar"></i> Poređenje budžeta</div>
                    <canvas id="comparisonBarChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title"><i class="fas fa-chart-line"></i> Poređenje napretka</div>
                    <canvas id="comparisonLineChart"></canvas>
                </div>
            </div>
            
            <div class="project-metrics-grid" id="comparisonMetrics">
                <!-- Comparison metrics will be populated here -->
            </div>
        </div>
        
        <div class="ai-suggestion">
            <h4><i class="fas fa-robot"></i> AI Analiza</h4>
            <p id="dashboardAIAnalysis">Analiziram podatke vaših projekata...</p>
        </div>
        
        <div class="modal-actions">
            <button type="button" class="btn btn-primary" onclick="exportDashboardCharts()">
                <i class="fas fa-download"></i> Preuzmi grafikone
            </button>
            <button type="button" class="btn" style="background: rgba(255, 255, 255, 0.1);" onclick="closeDashboardModal()">
                Zatvori
            </button>
        </div>
    </div>
</div>

<!-- Modal for adding subproject -->
<div class="modal" id="subprojectModal">
    <div class="modal-content">
        <h2 style="margin-top: 0; color: var(--main-green);"><i class="fas fa-sitemap"></i> Novi podprojekt</h2>
        <form id="subprojectForm">
            <input type="hidden" id="parentProjectId">
            
            <div class="form-group">
                <label for="subprojectName">Naziv podprojekta *</label>
                <input type="text" id="subprojectName" class="form-control" required placeholder="Unesite naziv podprojekta">
            </div>
            
            <div class="form-group">
                <label for="subprojectDescription">Opis podprojekta</label>
                <textarea id="subprojectDescription" class="form-control" rows="2" placeholder="Unesite opis podprojekta"></textarea>
            </div>
            
            <div class="form-group">
                <label for="subprojectStart">Početak podprojekta</label>
                <input type="datetime-local" id="subprojectStart" class="form-control">
            </div>
            
            <div class="form-group">
                <label for="subprojectDeadline">Rok završetka</label>
                <input type="datetime-local" id="subprojectDeadline" class="form-control">
            </div>
            
            <div class="form-group">
                <label for="subprojectPriority">Prioritet</label>
                <select id="subprojectPriority" class="form-control">
                    <option value="Visok">Visok</option>
                    <option value="Srednji">Srednji</option>
                    <option value="Nizak">Nizak</option>
                </select>
            </div>
            
            <div class="form-group">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="addToHabitTracker" checked style="width: 18px; height: 18px;">
                    <label for="addToHabitTracker" style="margin-bottom: 0; cursor: pointer;">Dodaj u Habit Tracker</label>
                </div>
                <small style="color: #888; font-size: 11px;">Podprojekt će se automatski dodati u Habit Tracker kao zadatak za praćenje.</small>
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn" style="background: rgba(255, 255, 255, 0.1);" onclick="closeSubprojectModal()">Odustani</button>
                <button type="submit" class="btn btn-primary">Dodaj podprojekt</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal for calendar day tasks -->
<div class="modal" id="calendarDayModal">
    <div class="modal-content">
        <h2 style="margin-top: 0; color: var(--future-purple);"><i class="fas fa-calendar-day"></i> Zadaci za <span id="modalDayTitle"></span></h2>
        
        <div class="task-list" id="dayTasksList">
            <!-- Tasks will be populated by JavaScript -->
        </div>
        
        <div style="margin-top: 20px;">
            <h3 style="color: var(--main-green); font-size: 14px; margin-bottom: 10px;">Dodaj novi zadatak</h3>
            <div class="form-group">
                <input type="text" id="newTaskName" class="form-control" placeholder="Naziv zadatka" style="margin-bottom: 10px;">
                <select id="newTaskProject" class="form-control" style="margin-bottom: 10px;">
                    <option value="">Odaberite projekt</option>
                    <!-- Project options will be populated -->
                </select>
                <button class="btn btn-purple" onclick="addTaskToDay()" style="width: 100%;">
                    <i class="fas fa-plus"></i> Dodaj zadatak
                </button>
            </div>
        </div>
        
        <div class="modal-actions">
            <button type="button" class="btn" style="background: rgba(255, 255, 255, 0.1);" onclick="closeCalendarDayModal()">Zatvori</button>
        </div>
    </div>
</div>

<!-- Modal for time tracking -->
<div class="modal" id="timeTrackModal">
    <div class="modal-content">
        <h2 style="margin-top: 0; color: var(--blue-accent);"><i class="fas fa-clock"></i> Evidencija vremena - <span id="timeProjectName"></span></h2>
        
        <div class="form-group">
            <label for="timeTrackHours">Broj sati</label>
            <input type="number" id="timeTrackHours" class="form-control" min="0.5" max="100" step="0.5" value="1">
        </div>
        
        <div class="form-group">
            <label for="timeTrackDate">Datum</label>
            <input type="date" id="timeTrackDate" class="form-control" value="2026-01-15">
        </div>
        
        <div class="form-group">
            <label for="timeTrackDescription">Opis rada</label>
            <textarea id="timeTrackDescription" class="form-control" rows="3" placeholder="Šta ste radili..."></textarea>
        </div>
        
        <div class="task-list" id="timeTrackHistory" style="max-height: 200px;">
            <!-- History will be populated -->
        </div>
        
        <div class="modal-actions">
            <button type="button" class="btn" style="background: rgba(255, 255, 255, 0.1);" onclick="closeTimeTrackModal()">Odustani</button>
            <button type="button" class="btn btn-primary" onclick="saveTimeTracking()">Spremi vrijeme</button>
        </div>
    </div>
</div>

<!-- Toast Notification Container -->
<div id="toastContainer"></div>

<script>
    // Main Data Structures
    let projects = [];
    let habits = [];
    let calendarEvents = {};
    let timeTracking = {};
    let categories = new Set(['AGRO', 'ESP', 'Posao', 'Osobni', 'Edukacija', 'Zdravlje', 'Financije', 'Ostalo']);
    
    // Chart instances
    let donutChart = null;
    let lineChart = null;
    let barChart = null;
    let radarChart = null;
    let areaChart = null;
    let scatterChart = null;
    let pieChart = null;
    let gaugeChart = null;
    let comparisonBarChart = null;
    let comparisonLineChart = null;
    
    // Current state
    let currentMonth = 0; // January (0-indexed)
    let currentYear = 2026;
    let currentHabitMonth = 0; // January
    let currentHabitYear = 2026;
    let selectedProjectForSubproject = null;
    let selectedDayForCalendar = null;
    let selectedProjectForTimeTracking = null;
    let editingProjectId = null;

    // DOM Elements
    const projectsTable = document.getElementById('projectsTable').getElementsByTagName('tbody')[0];
    const projectModal = document.getElementById('projectModal');
    const projectForm = document.getElementById('projectForm');
    const progressValue = document.getElementById('progressValue');
    const projectProgress = document.getElementById('projectProgress');
    const projectFilter = document.getElementById('projectFilter');
    const exportExcelBtn = document.getElementById('exportExcel');
    const exportPdfBtn = document.getElementById('exportPdf');
    const clearAllBtn = document.getElementById('clearAll');
    const addProjectBtn = document.getElementById('addProjectBtn');
    const cancelProjectBtn = document.getElementById('cancelProject');
    const sortByDateBtn = document.getElementById('sortByDate');
    const sortByProgressBtn = document.getElementById('sortByProgress');
    const currentDateElement = document.getElementById('currentDate');
    const calendarGrid = document.getElementById('calendarGrid');
    const modalProjectTitle = document.getElementById('modalProjectTitle');
    const submitProjectBtn = document.getElementById('submitProjectBtn');
    const dashboardBtn = document.getElementById('dashboardBtn');
    const dashboardModal = document.getElementById('dashboardModal');
    
    // Project form elements
    const projectSatisfaction = document.getElementById('projectSatisfaction');
    const satisfactionValue = document.getElementById('satisfactionValue');
    const projectComplexity = document.getElementById('projectComplexity');
    const complexityValue = document.getElementById('complexityValue');
    
    // Habit Tracker Elements
    const habitProjectFilter = document.getElementById('habitProjectFilter');
    const habitMonthSelect = document.getElementById('habitMonthSelect');
    const habitYearSelect = document.getElementById('habitYearSelect');
    const newHabitTask = document.getElementById('newHabitTask');
    const habitMonthDisplay = document.getElementById('habitMonthDisplay');
    const improvedHabitGrid = document.getElementById('improvedHabitGrid');
    const monthlyCompletion = document.getElementById('monthlyCompletion');
    const totalTasks = document.getElementById('totalTasks');
    const completedDays = document.getElementById('completedDays');
    const consistency = document.getElementById('consistency');
    
    // Modals
    const subprojectModal = document.getElementById('subprojectModal');
    const subprojectForm = document.getElementById('subprojectForm');
    const calendarDayModal = document.getElementById('calendarDayModal');
    const timeTrackModal = document.getElementById('timeTrackModal');
    
    // Dashboard elements
    const dashboardAIAnalysis = document.getElementById('dashboardAIAnalysis');
    const dashboardProjectsTable = document.getElementById('dashboardProjectsTable');
    const dashboardTotalBudget = document.getElementById('dashboardTotalBudget');
    const dashboardAvgTime = document.getElementById('dashboardAvgTime');
    const dashboardTotalTeam = document.getElementById('dashboardTotalTeam');
    const dashboardAvgComplexity = document.getElementById('dashboardAvgComplexity');
    const compareProject1 = document.getElementById('compareProject1');
    const compareProject2 = document.getElementById('compareProject2');
    const comparisonMetrics = document.getElementById('comparisonMetrics');
    
    // KPI Interactive Cards
    const kpiCards = {
        totalProjects: document.getElementById('kpiTotalProjects'),
        runningProjects: document.getElementById('kpiRunningProjects'),
        activeTasks: document.getElementById('kpiActiveTasks'),
        timeSpent: document.getElementById('kpiTimeSpent'),
        avgTime: document.getElementById('kpiAvgTime'),
        weeklyProgress: document.getElementById('kpiWeeklyProgress')
    };
    
    // Stat Interactive Cards
    const statCards = {
        monthlyCompletion: document.getElementById('statMonthlyCompletion'),
        totalTasks: document.getElementById('statTotalTasks'),
        completedDays: document.getElementById('statCompletedDays'),
        consistency: document.getElementById('statConsistency')
    };

    // Initialize Dashboard
    document.addEventListener('DOMContentLoaded', function() {
        // Set current date
        const now = new Date(2026, 0, 15); // Fixed to 2026 for demo
        currentDateElement.textContent = now.toLocaleDateString('hr-HR', {
            day: 'numeric', month: 'long', year: 'numeric'
        });

        // Load from localStorage
        loadData();
        
        // Initialize UI
        renderProjects();
        renderCalendar();
        renderImprovedHabitTracker();
        
        // Update KPIs
        updateKPICards();
        
        // Initialize event listeners
        initEventListeners();
        
        // Set default datetime values
        setDefaultDateTimeValues();
        
        // Add custom categories from existing projects
        updateCategorySuggestions();
        
        // Initialize tab functionality
        initTabs();
    });

    // Initialize tab functionality
    function initTabs() {
        // Project modal tabs
        document.querySelectorAll('#projectModal .modal-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Update active tab
                document.querySelectorAll('#projectModal .modal-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Show corresponding content
                document.querySelectorAll('#projectModal .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabId + 'Tab').classList.add('active');
            });
        });
        
        // Dashboard modal tabs
        document.querySelectorAll('#dashboardModal .modal-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Update active tab
                document.querySelectorAll('#dashboardModal .modal-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Show corresponding content
                document.querySelectorAll('#dashboardModal .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabId + 'Tab').classList.add('active');
                
                // Generate charts for the active tab
                if (tabId === 'overview') {
                    setTimeout(generateOverviewCharts, 50);
                } else if (tabId === 'detailed') {
                    setTimeout(generateDetailedCharts, 50);
                } else if (tabId === 'comparison') {
                    populateComparisonDropdowns();
                }
            });
        });
    }

    // Set default datetime values
    function setDefaultDateTimeValues() {
        const now = new Date(2026, 0, 15, 9, 0);
        const tomorrow = new Date(2026, 0, 30, 17, 0);
        
        // Format for datetime-local input
        function formatDateTimeLocal(date) {
            return date.toISOString().slice(0, 16);
        }
        
        // Project form defaults
        document.getElementById('projectStart').value = formatDateTimeLocal(now);
        document.getElementById('projectEnd').value = formatDateTimeLocal(tomorrow);
        
        // Subproject form defaults
        document.getElementById('subprojectStart').value = formatDateTimeLocal(now);
        document.getElementById('subprojectDeadline').value = formatDateTimeLocal(tomorrow);
        
        // Time tracking default
        document.getElementById('timeTrackDate').value = "2026-01-15";
    }

    // Load data from localStorage
    function loadData() {
        const savedProjects = localStorage.getItem('projects2026');
        const savedHabits = localStorage.getItem('habits2026');
        const savedTimeTracking = localStorage.getItem('timeTracking2026');
        const savedCategories = localStorage.getItem('categories2026');
        
        if (savedProjects) {
            projects = JSON.parse(savedProjects);
        }
        
        if (savedHabits) {
            habits = JSON.parse(savedHabits);
        } else {
            // Initialize with sample habits
            initializeSampleHabits();
        }
        
        if (savedTimeTracking) {
            timeTracking = JSON.parse(savedTimeTracking);
        } else {
            timeTracking = {};
        }
        
        if (savedCategories) {
            const loadedCategories = JSON.parse(savedCategories);
            loadedCategories.forEach(cat => categories.add(cat));
        }
        
        // Initialize calendar events
        updateCalendarEvents();
        
        // Update project filter in habit tracker
        updateHabitProjectFilter();
        
        // Add sample projects if none exist
        if (projects.length === 0) {
            initializeSampleProjects();
        }
    }

    // Initialize sample projects
    function initializeSampleProjects() {
        const sampleProjects = [
            {
                id: 1,
                name: "AGRO Posao - Digitalizacija farme",
                description: "Digitalna transformacija poljoprivredne farme",
                category: "AGRO",
                start: "2026-01-01T09:00",
                end: "2026-06-30T17:00",
                progress: 45,
                status: "running",
                budget: 25000,
                teamSize: 5,
                priority: "high",
                riskLevel: "medium",
                satisfaction: 8,
                complexity: 7,
                tags: "digitalizacija, poljoprivreda, IoT",
                client: "Farma Marković",
                stakeholders: "Ivan Marković, Marija Kovač, Marko Petrović",
                dependencies: [],
                technology: "React, Node.js, IoT senzori",
                timeSpent: [
                    { id: 1, hours: 40, date: "2026-01-10", description: "Analiza zahtjeva", timestamp: "2026-01-10T12:00:00" },
                    { id: 2, hours: 35, date: "2026-01-15", description: "Razvoj UI", timestamp: "2026-01-15T14:30:00" }
                ],
                subprojects: [
                    { id: 101, name: "UI dizajn", description: "Dizajn korisničkog interfejsa", start: "2026-01-05T09:00", deadline: "2026-02-15T17:00", priority: "Visok", progress: 80, parentProjectId: 1, parentProjectName: "AGRO Posao - Digitalizacija farme" }
                ],
                createdAt: "2025-12-15T10:00:00"
            },
            {
                id: 2,
                name: "ESP32 IoT Monitoring System",
                description: "Sistem za praćenje temperature i vlage",
                category: "ESP",
                start: "2026-01-10T10:00",
                end: "2026-03-31T18:00",
                progress: 70,
                status: "running",
                budget: 12000,
                teamSize: 3,
                priority: "medium",
                riskLevel: "low",
                satisfaction: 9,
                complexity: 6,
                tags: "IoT, ESP32, monitoring",
                client: "Tech Solutions d.o.o.",
                stakeholders: "Ana Horvat, Petar Novak",
                dependencies: [],
                technology: "ESP32, C++, MQTT, React Native",
                timeSpent: [
                    { id: 3, hours: 50, date: "2026-01-12", description: "Razvoj firmware-a", timestamp: "2026-01-12T16:45:00" },
                    { id: 4, hours: 30, date: "2026-01-14", description: "Testiranje senzora", timestamp: "2026-01-14T11:20:00" }
                ],
                subprojects: [],
                createdAt: "2025-12-20T14:30:00"
            },
            {
                id: 3,
                name: "Personal Health Tracker",
                description: "Aplikacija za praćenje zdravstvenih metrika",
                category: "Zdravlje",
                start: "2026-02-01T08:00",
                end: "2026-05-15T16:00",
                progress: 20,
                status: "upcoming",
                budget: 8000,
                teamSize: 2,
                priority: "medium",
                riskLevel: "medium",
                satisfaction: 6,
                complexity: 5,
                tags: "zdravlje, mobile, fitness",
                client: "Personal",
                stakeholders: "Osobni projekt",
                dependencies: [],
                technology: "Flutter, Firebase, HealthKit",
                timeSpent: [],
                subprojects: [],
                createdAt: "2026-01-05T09:15:00"
            }
        ];
        
        projects.push(...sampleProjects);
        saveData();
    }

    // Initialize sample habits
    function initializeSampleHabits() {
        habits = [
            {
                id: 1,
                name: '🌅 Morning Routine',
                description: 'Dnevna jutarnja rutina',
                category: 'Osobni',
                color: '#667eea',
                projectId: null,
                projectName: null,
                subprojectId: null,
                created: '2026-01-01',
                days: {
                    '2026-01-01': true,
                    '2026-01-02': true,
                    '2026-01-03': true,
                    '2026-01-05': true,
                    '2026-01-07': true,
                    '2026-01-08': true,
                    '2026-01-10': true,
                    '2026-01-12': true,
                    '2026-01-13': true,
                    '2026-01-14': true
                }
            },
            {
                id: 2,
                name: '💼 Rad na AGRO projektu',
                description: 'Najmanje 2h fokusiranog rada',
                category: 'AGRO',
                color: '#00ff88',
                projectId: 1,
                projectName: 'AGRO Posao - Digitalizacija farme',
                subprojectId: 101,
                created: '2026-01-01',
                days: {
                    '2026-01-02': true,
                    '2026-01-03': true,
                    '2026-01-04': true,
                    '2026-01-05': true,
                    '2026-01-08': true,
                    '2026-01-09': true,
                    '2026-01-10': true,
                    '2026-01-11': true,
                    '2026-01-12': true,
                    '2026-01-14': true
                }
            }
        ];
        
        saveData();
    }

    // Update habit project filter dropdown
    function updateHabitProjectFilter() {
        habitProjectFilter.innerHTML = '<option value="all">Svi projekti</option>';
        projects.forEach(project => {
            const option = document.createElement('option');
            option.value = project.id;
            option.textContent = project.name;
            habitProjectFilter.appendChild(option);
        });
    }

    // Update category suggestions
    function updateCategorySuggestions() {
        const datalist = document.getElementById('categorySuggestions');
        // Clear existing options except defaults
        const defaultCats = ['AGRO', 'ESP', 'Posao', 'Osobni', 'Edukacija', 'Zdravlje', 'Financije', 'Privatni posao i zdravlje'];
        
        // Add custom categories
        categories.forEach(category => {
            if (!defaultCats.includes(category)) {
                const option = document.createElement('option');
                option.value = category;
                datalist.appendChild(option);
            }
        });
    }

    // Save data to localStorage
    function saveData() {
        localStorage.setItem('projects2026', JSON.stringify(projects));
        localStorage.setItem('habits2026', JSON.stringify(habits));
        localStorage.setItem('timeTracking2026', JSON.stringify(timeTracking));
        localStorage.setItem('categories2026', JSON.stringify(Array.from(categories)));
    }

    // Update calendar events from projects and tasks
    function updateCalendarEvents() {
        calendarEvents = {};
        
        // Add project start dates
        projects.forEach(project => {
            const startDate = project.start.split('T')[0];
            if (!calendarEvents[startDate]) {
                calendarEvents[startDate] = [];
            }
            calendarEvents[startDate].push({
                name: `Početak: ${project.name}`,
                projectId: project.id,
                projectName: project.name,
                type: 'project_start'
            });
            
            // Add project end dates
            const endDate = project.end.split('T')[0];
            if (endDate !== startDate) {
                if (!calendarEvents[endDate]) {
                    calendarEvents[endDate] = [];
                }
                calendarEvents[endDate].push({
                    name: `Rok: ${project.name}`,
                    projectId: project.id,
                    projectName: project.name,
                    type: 'project_end'
                });
            }
        });
        
        // Add subproject dates
        projects.forEach(project => {
            if (project.subprojects) {
                project.subprojects.forEach(subproject => {
                    if (subproject.start) {
                        const subStartDate = subproject.start.split('T')[0];
                        if (!calendarEvents[subStartDate]) {
                            calendarEvents[subStartDate] = [];
                        }
                        calendarEvents[subStartDate].push({
                            name: `Podprojekt: ${subproject.name}`,
                            projectId: project.id,
                            projectName: project.name,
                            subprojectId: subproject.id,
                            type: 'subproject_start'
                        });
                    }
                    
                    if (subproject.deadline) {
                        const subDeadline = subproject.deadline.split('T')[0];
                        if (!calendarEvents[subDeadline]) {
                            calendarEvents[subDeadline] = [];
                        }
                        calendarEvents[subDeadline].push({
                            name: `Rok podprojekta: ${subproject.name}`,
                            projectId: project.id,
                            projectName: project.name,
                            subprojectId: subproject.id,
                            type: 'subproject_deadline'
                        });
                    }
                });
            }
        });
    }

    // Render projects table
    function renderProjects() {
        projectsTable.innerHTML = '';
        
        let filteredProjects = [...projects];
        const filterValue = projectFilter.value;
        
        if (filterValue !== 'all') {
            filteredProjects = filteredProjects.filter(p => p.status === filterValue);
        }
        
        if (filteredProjects.length === 0) {
            const row = projectsTable.insertRow();
            row.innerHTML = `
                <td colspan="8" style="text-align: center; padding: 30px; color: #777;">
                    <i class="fas fa-folder-open" style="font-size: 24px; margin-bottom: 10px; display: block; opacity: 0.3;"></i>
                    Nema projekata.
                </td>
            `;
            return;
        }
        
        filteredProjects.forEach(project => {
            const row = projectsTable.insertRow();
            
            // Calculate subprojects count
            const subprojectsCount = project.subprojects ? project.subprojects.length : 0;
            
            // Calculate total time spent
            const totalTime = project.timeSpent ? project.timeSpent.reduce((sum, entry) => sum + entry.hours, 0) : 0;
            
            // Get category tag class
            const categoryClass = getCategoryClass(project.category);
            
            // Status styling
            let statusClass, statusText;
            switch(project.status) {
                case 'running':
                    statusClass = 'status-running';
                    statusText = 'Aktivan';
                    break;
                case 'upcoming':
                    statusClass = 'status-upcoming';
                    statusText = 'Nadolazeći';
                    break;
                case 'completed':
                    statusClass = 'status-completed';
                    statusText = 'Završen';
                    break;
            }
            
            // Format dates with time
            const startDate = new Date(project.start);
            const endDate = new Date(project.end);
            const startFormatted = startDate.toLocaleDateString('hr-HR') + ' ' + startDate.toLocaleTimeString('hr-HR', {hour: '2-digit', minute:'2-digit'});
            const endFormatted = endDate.toLocaleDateString('hr-HR') + ' ' + endDate.toLocaleTimeString('hr-HR', {hour: '2-digit', minute:'2-digit'});
            
            row.innerHTML = `
                <td>
                    <div class="project-name-link" onclick="openSubprojectModal(${project.id})" style="cursor: pointer;">
                        <strong>${project.name}</strong>
                        <div style="font-size: 11px; color: #888; margin-top: 2px;">
                            <i class="fas fa-sitemap"></i> ${subprojectsCount} podprojekta
                        </div>
                    </div>
                    <div style="font-size: 11px; color: #aaa; margin-top: 3px;">${project.description || 'Nema opisa'}</div>
                </td>
                <td>
                    <span class="category-tag ${categoryClass}">${project.category}</span>
                </td>
                <td>${startFormatted}</td>
                <td>${endFormatted}</td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${project.progress}%"></div>
                    </div>
                    <div style="font-size: 11px; margin-top: 4px; color: ${project.progress > 70 ? '#00ff88' : project.progress > 30 ? '#ffaa00' : '#ff5555'}">
                        ${project.progress}%
                    </div>
                </td>
                <td>
                    <div style="font-size: 14px; font-weight: 600; color: var(--blue-accent);">${totalTime}h</div>
                    <button class="time-track-btn" onclick="openTimeTrackModal(${project.id})" style="margin-top: 4px;">
                        <i class="fas fa-plus"></i> Dodaj vrijeme
                    </button>
                </td>
                <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                <td>
                    <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                        <button class="complete-btn ${project.status === 'completed' ? 'completed' : ''}" 
                                onclick="completeProject(${project.id})" 
                                style="font-size: 10px; padding: 5px 10px;"
                                title="${project.status === 'completed' ? 'Projekt završen' : 'Označi kao završen'}">
                            <i class="fas ${project.status === 'completed' ? 'fa-check-circle' : 'fa-check'}"></i>
                            ${project.status === 'completed' ? 'Završen' : 'Završi'}
                        </button>
                        <button class="action-btn" onclick="editProject(${project.id})" style="font-size: 10px; padding: 5px 10px;" title="Uredi projekt">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="deleteProject(${project.id})" style="font-size: 10px; padding: 5px 10px; background: rgba(255, 85, 85, 0.2); color: #ff5555;" title="Obriši projekt">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
        });
    }

    // Get CSS class for category tag
    function getCategoryClass(category) {
        if (category.toUpperCase() === 'AGRO') return 'category-agro';
        if (category.toUpperCase() === 'ESP') return 'category-esp';
        return 'category-custom';
    }

    // Render calendar with purple dots
    function renderCalendar() {
        calendarGrid.innerHTML = '';
        
        const monthNames = ["SIJEČANJ", "VELJAČA", "OŽUJAK", "TRAVANJ", "SVIBANJ", "LIPANJ", 
                           "SRPANJ", "KOLOVOZ", "RUJAN", "LISTOPAD", "STUDENI", "PROSINAC"];
        
        // Update month/year display
        document.getElementById('currentMonthYear').textContent = `${monthNames[currentMonth]} ${currentYear}`;
        
        // Add day headers
        const days = ['PON', 'UTO', 'SRI', 'ČET', 'PET', 'SUB', 'NED'];
        days.forEach(day => {
            const dayElement = document.createElement('div');
            dayElement.className = 'cal-day-header';
            dayElement.textContent = day;
            calendarGrid.appendChild(dayElement);
        });
        
        // Get first day of month
        const firstDay = new Date(currentYear, currentMonth, 1);
        const startDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;
        
        // Get number of days in month
        const lastDay = new Date(currentYear, currentMonth + 1, 0);
        const daysInMonth = lastDay.getDate();
        
        // Add empty cells for days before first day of month
        for (let i = 0; i < startDay; i++) {
            const emptyCell = document.createElement('div');
            emptyCell.className = 'cal-day';
            calendarGrid.appendChild(emptyCell);
        }
        
        // Add days of month
        const today = new Date(2026, 0, 15); // Fixed to 2026-01-15 for demo
        const isCurrentMonth = today.getMonth() === currentMonth && today.getFullYear() === currentYear;
        
        for (let day = 1; day <= daysInMonth; day++) {
            const dayElement = document.createElement('div');
            const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            
            const hasEvents = calendarEvents[dateStr];
            const isToday = isCurrentMonth && day === today.getDate();
            
            dayElement.className = 'cal-day';
            if (isToday) dayElement.classList.add('today');
            if (hasEvents) dayElement.classList.add('has-event');
            
            dayElement.innerHTML = `<strong>${day}</strong>`;
            
            if (hasEvents) {
                // Add purple dot for events
                const dot = document.createElement('div');
                dot.className = 'event-dot';
                dayElement.appendChild(dot);
            }
            
            // Add click event
            dayElement.onclick = () => openCalendarDayModal(dateStr, day);
            calendarGrid.appendChild(dayElement);
        }
    }

    // Open calendar day modal
    function openCalendarDayModal(dateStr, day) {
        selectedDayForCalendar = dateStr;
        
        const date = new Date(dateStr);
        const dayName = ['Nedjelja', 'Ponedjeljak', 'Utorak', 'Srijeda', 'Četvrtak', 'Petak', 'Subota'][date.getDay()];
        document.getElementById('modalDayTitle').textContent = `${dayName}, ${day}. ${currentMonth + 1}. ${currentYear}.`;
        
        // Populate tasks for this day
        const tasksList = document.getElementById('dayTasksList');
        tasksList.innerHTML = '';
        
        const events = calendarEvents[dateStr] || [];
        
        if (events.length === 0) {
            tasksList.innerHTML = `
                <div style="text-align: center; padding: 20px; color: #777;">
                    <i class="fas fa-calendar-times" style="font-size: 24px; margin-bottom: 10px; display: block; opacity: 0.3;"></i>
                    Nema zadataka za ovaj dan.
                </div>
            `;
        } else {
            events.forEach(event => {
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item';
                
                let icon = '📋';
                if (event.type === 'project_start') icon = '🚀';
                if (event.type === 'project_end') icon = '🏁';
                if (event.type === 'subproject_start') icon = '📌';
                if (event.type === 'subproject_deadline') icon = '⏰';
                
                taskItem.innerHTML = `
                    <div>
                        <strong>${icon} ${event.name}</strong>
                        <div style="font-size: 11px; color: #aaa;">Projekt: ${event.projectName}</div>
                    </div>
                    <div>
                        <button class="action-btn" onclick="editCalendarTask('${dateStr}', ${event.projectId}, '${event.type}')" style="font-size: 10px;">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                `;
                tasksList.appendChild(taskItem);
            });
        }
        
        // Populate project dropdown for new task
        const projectSelect = document.getElementById('newTaskProject');
        projectSelect.innerHTML = '<option value="">Odaberite projekt</option>';
        projects.forEach(project => {
            const option = document.createElement('option');
            option.value = project.id;
            option.textContent = project.name;
            projectSelect.appendChild(option);
        });
        
        calendarDayModal.style.display = 'flex';
    }

    // Close calendar day modal
    function closeCalendarDayModal() {
        calendarDayModal.style.display = 'none';
        selectedDayForCalendar = null;
    }

    // Open subproject modal
    function openSubprojectModal(projectId) {
        selectedProjectForSubproject = projectId;
        const project = projects.find(p => p.id === projectId);
        
        if (!project) {
            showToast('Projekt nije pronađen!', 'error');
            return;
        }
        
        document.getElementById('parentProjectId').value = projectId;
        document.getElementById('subprojectName').value = '';
        document.getElementById('subprojectDescription').value = '';
        
        // Set default start to project start date
        const startInput = document.getElementById('subprojectStart');
        const deadlineInput = document.getElementById('subprojectDeadline');
        
        if (startInput && project.start) {
            startInput.value = project.start.slice(0, 16); // Remove seconds
        }
        
        if (deadlineInput && project.end) {
            deadlineInput.value = project.end.slice(0, 16); // Remove seconds
        }
        
        subprojectModal.style.display = 'flex';
    }

    // Close subproject modal
    function closeSubprojectModal() {
        subprojectModal.style.display = 'none';
        subprojectForm.reset();
        setDefaultDateTimeValues();
    }

    // Add subproject
    function addSubproject(event) {
        event.preventDefault();
        
        const projectId = parseInt(document.getElementById('parentProjectId').value);
        const name = document.getElementById('subprojectName').value.trim();
        const description = document.getElementById('subprojectDescription').value.trim();
        const start = document.getElementById('subprojectStart').value;
        const deadline = document.getElementById('subprojectDeadline').value;
        const priority = document.getElementById('subprojectPriority').value;
        const addToHabit = document.getElementById('addToHabitTracker').checked;
        
        if (!name) {
            showToast('Unesite naziv podprojekta!', 'warning');
            return;
        }
        
        const project = projects.find(p => p.id === projectId);
        if (!project) {
            showToast('Projekt nije pronađen!', 'error');
            return;
        }
        
        // Create subproject
        const subproject = {
            id: Date.now(),
            name,
            description,
            start,
            deadline,
            priority,
            progress: 0,
            parentProjectId: projectId,
            parentProjectName: project.name,
            createdAt: new Date().toISOString()
        };
        
        // Add to project
        if (!project.subprojects) {
            project.subprojects = [];
        }
        project.subprojects.push(subproject);
        
        // Add to habit tracker if checkbox is checked
        if (addToHabit) {
            const newHabit = {
                id: Date.now(),
                name: `📋 ${name}`,
                description: `Podprojekt: ${project.name}`,
                category: project.category || 'Posao',
                color: getRandomColor(),
                subprojectId: subproject.id,
                projectId: projectId,
                projectName: project.name,
                created: new Date().toISOString().split('T')[0],
                days: {}
            };
            habits.push(newHabit);
        }
        
        saveData();
        
        // Update UI
        updateCalendarEvents();
        renderProjects();
        renderCalendar();
        renderImprovedHabitTracker();
        updateKPICards();
        
        // Close modal
        closeSubprojectModal();
        
        showToast(`Podprojekt "${name}" dodan!`, 'success');
    }

    // IMPROVED Habit Tracker Render with clickable task names
    function renderImprovedHabitTracker() {
        // Update month display
        const monthNames = ["Januar", "Februar", "Mart", "April", "Maj", "Juni", 
                           "Juli", "Avgust", "Septembar", "Oktobar", "Novembar", "Decembar"];
        habitMonthDisplay.textContent = `${monthNames[currentHabitMonth]} ${currentHabitYear}`;
        
        // Get days in month
        const daysInMonth = new Date(currentHabitYear, currentHabitMonth + 1, 0).getDate();
        
        // Get selected project filter
        const selectedProjectId = habitProjectFilter.value;
        
        // Filter habits
        let filteredHabits = habits;
        if (selectedProjectId !== 'all') {
            filteredHabits = habits.filter(h => h.projectId == selectedProjectId);
        }
        
        // Clear grid
        improvedHabitGrid.innerHTML = '';
        
        // Add header row - Task names
        const headerRow = document.createElement('div');
        headerRow.className = 'habit-cell task-name';
        headerRow.innerHTML = `
            <div style="font-weight: 600; color: #ddd;">ZADATAK (klikni za detalje)</div>
        `;
        improvedHabitGrid.appendChild(headerRow);
        
        // Add day headers
        for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(currentHabitYear, currentHabitMonth, day);
            const dayName = ['Ne', 'Po', 'Ut', 'Sr', 'Če', 'Pe', 'Su'][date.getDay()];
            
            const dayHeader = document.createElement('div');
            dayHeader.className = 'habit-cell header';
            dayHeader.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 10px; color: #888;">${dayName}</div>
                    <div style="font-size: 14px; font-weight: 600;">${day}</div>
                </div>
            `;
            improvedHabitGrid.appendChild(dayHeader);
        }
        
        // Add habit rows
        filteredHabits.forEach(habit => {
            // Task name cell
            const nameCell = document.createElement('div');
            nameCell.className = 'habit-cell task-name';
            nameCell.onclick = () => openHabitDetails(habit.id);
            
            let projectBadge = '';
            if (habit.projectName) {
                projectBadge = `<span class="project-badge">${habit.projectName}</span>`;
            }
            
            const categoryClass = getCategoryClass(habit.category);
            
            nameCell.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px; width: 100%;">
                    <div style="width: 4px; height: 20px; background: ${habit.color}; border-radius: 2px;"></div>
                    <div style="flex: 1; min-width: 0;">
                        <div style="display: flex; align-items: center; flex-wrap: wrap;">
                            <div style="font-weight: 600; color: #fff; font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="${habit.name}">
                                ${habit.name}
                            </div>
                            ${projectBadge}
                            <span class="category-tag ${categoryClass}" style="margin-left: 5px; font-size: 9px;">
                                ${habit.category}
                            </span>
                        </div>
                        <div style="font-size: 10px; color: #aaa; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="${habit.description}">
                            ${habit.description || ''}
                        </div>
                    </div>
                </div>
            `;
            improvedHabitGrid.appendChild(nameCell);
            
            // Day cells
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${currentHabitYear}-${String(currentHabitMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const isCompleted = habit.days && habit.days[dateStr];
                
                const dayCell = document.createElement('div');
                dayCell.className = `habit-cell day ${isCompleted ? 'completed' : ''}`;
                dayCell.onclick = () => toggleHabitDay(habit.id, dateStr);
                
                dayCell.innerHTML = `
                    <div class="day-checkbox ${isCompleted ? 'checked' : ''}">
                        ${isCompleted ? '<i class="fas fa-check"></i>' : ''}
                    </div>
                `;
                
                improvedHabitGrid.appendChild(dayCell);
            }
        });
        
        // Update stats
        updateHabitStats();
    }

    // Open habit details
    function openHabitDetails(habitId) {
        const habit = habits.find(h => h.id === habitId);
        if (!habit) return;
        
        alert(`Detalji zadatka:\n\nNaziv: ${habit.name}\nOpis: ${habit.description || 'Nema opisa'}\nKategorija: ${habit.category}\nProjekt: ${habit.projectName || 'Nije povezan'}\nKreiran: ${habit.created}`);
    }

    // Toggle habit day completion
    function toggleHabitDay(habitId, dateStr) {
        const habit = habits.find(h => h.id === habitId);
        if (!habit) return;
        
        if (!habit.days) habit.days = {};
        
        if (habit.days[dateStr]) {
            delete habit.days[dateStr];
        } else {
            habit.days[dateStr] = true;
        }
        
        saveData();
        renderImprovedHabitTracker();
        updateKPICards();
    }

    // Add new habit task
    function addHabitTask() {
        const taskName = newHabitTask.value.trim();
        if (!taskName) {
            showToast('Unesite naziv zadatka!', 'warning');
            return;
        }
        
        const selectedProjectId = habitProjectFilter.value;
        let projectName = null;
        let projectCategory = 'Osobni';
        
        if (selectedProjectId !== 'all') {
            const project = projects.find(p => p.id == selectedProjectId);
            projectName = project ? project.name : null;
            projectCategory = project ? project.category : 'Osobni';
        }
        
        const newHabit = {
            id: Date.now(),
            name: taskName,
            description: '',
            category: projectCategory,
            color: getRandomColor(),
            projectId: selectedProjectId !== 'all' ? parseInt(selectedProjectId) : null,
            projectName: projectName,
            subprojectId: null,
            created: new Date().toISOString().split('T')[0],
            days: {}
        };
        
        habits.push(newHabit);
        saveData();
        renderImprovedHabitTracker();
        
        newHabitTask.value = '';
        showToast(`Zadatak "${taskName}" dodan!`, 'success');
    }

    // Update habit statistics
    function updateHabitStats() {
        if (habits.length === 0) {
            monthlyCompletion.textContent = '0%';
            totalTasks.textContent = '0';
            completedDays.textContent = '0';
            consistency.textContent = '0%';
            return;
        }
        
        const daysInMonth = new Date(currentHabitYear, currentHabitMonth + 1, 0).getDate();
        let totalPossible = habits.length * daysInMonth;
        let totalCompleted = 0;
        let streak = 0;
        let maxStreak = 0;
        
        // Calculate stats for current month
        habits.forEach(habit => {
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${currentHabitYear}-${String(currentHabitMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                if (habit.days && habit.days[dateStr]) {
                    totalCompleted++;
                    streak++;
                    if (streak > maxStreak) maxStreak = streak;
                } else {
                    streak = 0;
                }
            }
        });
        
        // Update displays
        const completionRate = totalPossible > 0 ? Math.round((totalCompleted / totalPossible) * 100) : 0;
        monthlyCompletion.textContent = `${completionRate}%`;
        totalTasks.textContent = habits.length;
        completedDays.textContent = maxStreak;
        consistency.textContent = `${completionRate}%`;
    }

    // Open time tracking modal
    function openTimeTrackModal(projectId) {
        selectedProjectForTimeTracking = projectId;
        const project = projects.find(p => p.id === projectId);
        
        if (!project) {
            showToast('Projekt nije pronađen!', 'error');
            return;
        }
        
        document.getElementById('timeProjectName').textContent = project.name;
        
        // Initialize time tracking for project if not exists
        if (!timeTracking[projectId]) {
            timeTracking[projectId] = [];
        }
        
        if (!project.timeSpent) {
            project.timeSpent = [];
        }
        
        // Populate history
        const historyList = document.getElementById('timeTrackHistory');
        historyList.innerHTML = '';
        
        const history = project.timeSpent.slice(-5).reverse(); // Show last 5 entries
        
        if (history.length === 0) {
            historyList.innerHTML = `
                <div style="text-align: center; padding: 20px; color: #777;">
                    <i class="fas fa-history" style="font-size: 20px; margin-bottom: 10px; display: block; opacity: 0.3;"></i>
                    Nema evidencije vremena.
                </div>
            `;
        } else {
            history.forEach(entry => {
                const historyItem = document.createElement('div');
                historyItem.className = 'task-item';
                historyItem.innerHTML = `
                    <div>
                        <strong>${entry.hours}h</strong>
                        <div style="font-size: 11px; color: #aaa;">${entry.date} - ${entry.description || 'Bez opisa'}</div>
                    </div>
                    <div style="font-size: 11px; color: #888;">
                        ${new Date(entry.timestamp).toLocaleDateString('hr-HR')}
                    </div>
                `;
                historyList.appendChild(historyItem);
            });
        }
        
        timeTrackModal.style.display = 'flex';
    }

    // Close time tracking modal
    function closeTimeTrackModal() {
        timeTrackModal.style.display = 'none';
        selectedProjectForTimeTracking = null;
    }

    // Save time tracking
    function saveTimeTracking() {
        const hours = parseFloat(document.getElementById('timeTrackHours').value);
        const date = document.getElementById('timeTrackDate').value;
        const description = document.getElementById('timeTrackDescription').value.trim();
        
        if (!hours || hours <= 0) {
            showToast('Unesite validan broj sati!', 'warning');
            return;
        }
        
        const project = projects.find(p => p.id === selectedProjectForTimeTracking);
        if (!project) {
            showToast('Projekt nije pronađen!', 'error');
            return;
        }
        
        // Create time entry
        const timeEntry = {
            id: Date.now(),
            hours: hours,
            date: date,
            description: description,
            timestamp: new Date().toISOString()
        };
        
        // Add to project
        if (!project.timeSpent) {
            project.timeSpent = [];
        }
        project.timeSpent.push(timeEntry);
        
        // Add to time tracking
        if (!timeTracking[selectedProjectForTimeTracking]) {
            timeTracking[selectedProjectForTimeTracking] = [];
        }
        timeTracking[selectedProjectForTimeTracking].push(timeEntry);
        
        saveData();
        
        // Update UI
        renderProjects();
        updateKPICards();
        
        // Clear form
        document.getElementById('timeTrackDescription').value = '';
        
        // Update history
        openTimeTrackModal(selectedProjectForTimeTracking);
        
        showToast(`Dodano ${hours}h za projekt "${project.name}"!`, 'success');
    }

    // Open Dashboard modal - UPDATED with setTimeout
    function openDashboardModal() {
        dashboardModal.style.display = 'flex';
        
        // Use setTimeout to ensure modal is visible before Chart.js tries to calculate dimensions
        setTimeout(() => {
            // Generate overview charts by default
            generateOverviewCharts();
            
            // Populate dashboard metrics
            populateDashboardMetrics();
            
            // Generate AI analysis
            generateDashboardAIAnalysis();
        }, 100);
    }

    // Close Dashboard modal
    function closeDashboardModal() {
        dashboardModal.style.display = 'none';
        
        // Destroy all chart instances to prevent memory leaks
        destroyAllCharts();
    }

    // Destroy all chart instances
    function destroyAllCharts() {
        if (donutChart) donutChart.destroy();
        if (lineChart) lineChart.destroy();
        if (barChart) barChart.destroy();
        if (radarChart) radarChart.destroy();
        if (areaChart) areaChart.destroy();
        if (scatterChart) scatterChart.destroy();
        if (pieChart) pieChart.destroy();
        if (gaugeChart) gaugeChart.destroy();
        if (comparisonBarChart) comparisonBarChart.destroy();
        if (comparisonLineChart) comparisonLineChart.destroy();
    }

    // Generate overview charts
    function generateOverviewCharts() {
        generateDonutChart();
        generateLineChart();
        generateBarChart();
        generateRadarChart();
    }

    // Generate detailed charts
    function generateDetailedCharts() {
        generateAreaChart();
        generateScatterChart();
        generatePieChart();
        generateGaugeChart();
        populateDashboardProjectsTable();
    }

    // Generate donut chart for project categories
    function generateDonutChart() {
        const ctx = document.getElementById('donutChart').getContext('2d');
        
        // Count projects by category
        const categoryCount = {};
        projects.forEach(project => {
            if (!categoryCount[project.category]) {
                categoryCount[project.category] = 0;
            }
            categoryCount[project.category]++;
        });
        
        const labels = Object.keys(categoryCount);
        const data = Object.values(categoryCount);
        
        // Colors for each category
        const backgroundColors = labels.map(label => {
            if (label.toUpperCase() === 'AGRO') return '#27ae60';
            if (label.toUpperCase() === 'ESP') return '#3498db';
            return getRandomColor();
        });
        
        if (donutChart) donutChart.destroy();
        
        donutChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: backgroundColors,
                    borderColor: backgroundColors.map(color => color.replace('0.8', '1')),
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: '#fff',
                            font: {
                                size: 11
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `${label}: ${value} projekata (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });
    }

    // Generate line chart for project progress
    function generateLineChart() {
        const ctx = document.getElementById('lineChart').getContext('2d');
        
        // Get progress data for each project
        const projectNames = projects.map(p => p.name);
        const progressData = projects.map(p => p.progress);
        
        // Colors based on progress
        const backgroundColors = progressData.map(progress => {
            if (progress >= 80) return 'rgba(0, 255, 136, 0.5)';
            if (progress >= 50) return 'rgba(255, 170, 0, 0.5)';
            return 'rgba(255, 85, 85, 0.5)';
        });
        
        if (lineChart) lineChart.destroy();
        
        lineChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: projectNames,
                datasets: [{
                    label: 'Napredak projekata (%)',
                    data: progressData,
                    backgroundColor: backgroundColors,
                    borderColor: '#00ff88',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            color: '#ccc'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    },
                    x: {
                        ticks: {
                            color: '#ccc',
                            maxRotation: 45
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#fff'
                        }
                    }
                }
            }
        });
    }

    // Generate bar chart for time spent
    function generateBarChart() {
        const ctx = document.getElementById('barChart').getContext('2d');
        
        // Get time spent data for each project
        const projectNames = projects.map(p => p.name.substring(0, 15) + (p.name.length > 15 ? '...' : ''));
        const timeSpentData = projects.map(p => {
            return p.timeSpent ? p.timeSpent.reduce((sum, entry) => sum + entry.hours, 0) : 0;
        });
        
        if (barChart) barChart.destroy();
        
        barChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: projectNames,
                datasets: [{
                    label: 'Utrošeno vrijeme (h)',
                    data: timeSpentData,
                    backgroundColor: projects.map(p => {
                        if (p.category.toUpperCase() === 'AGRO') return 'rgba(39, 174, 96, 0.7)';
                        if (p.category.toUpperCase() === 'ESP') return 'rgba(52, 152, 219, 0.7)';
                        return getRandomColor();
                    }),
                    borderColor: projects.map(p => {
                        if (p.category.toUpperCase() === 'AGRO') return '#27ae60';
                        if (p.category.toUpperCase() === 'ESP') return '#3498db';
                        return '#fff';
                    }),
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            color: '#ccc'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    },
                    x: {
                        ticks: {
                            color: '#ccc',
                            maxRotation: 45
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#fff'
                        }
                    }
                }
            }
        });
    }

    // Generate radar chart for project status
    function generateRadarChart() {
        const ctx = document.getElementById('radarChart').getContext('2d');
        
        // Calculate average metrics
        const avgProgress = projects.length > 0 ? projects.reduce((sum, p) => sum + p.progress, 0) / projects.length : 0;
        const avgSatisfaction = projects.length > 0 ? projects.reduce((sum, p) => sum + (p.satisfaction || 5), 0) / projects.length : 0;
        const avgComplexity = projects.length > 0 ? projects.reduce((sum, p) => sum + (p.complexity || 5), 0) / projects.length : 0;
        const avgTimeEfficiency = projects.length > 0 ? projects.reduce((sum, p) => {
            const timeSpent = p.timeSpent ? p.timeSpent.reduce((s, e) => s + e.hours, 0) : 0;
            const progress = p.progress;
            return sum + (progress > 0 ? timeSpent / progress : 0);
        }, 0) / projects.length : 0;
        
        // Normalize time efficiency (lower is better)
        const normalizedTimeEfficiency = Math.min(avgTimeEfficiency * 2, 10);
        
        if (radarChart) radarChart.destroy();
        
        radarChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['Napredak', 'Zadovoljstvo', 'Kompleksnost', 'Efikasnost'],
                datasets: [{
                    label: 'Prosječne metrike',
                    data: [avgProgress, avgSatisfaction * 10, avgComplexity * 10, (10 - normalizedTimeEfficiency) * 10],
                    backgroundColor: 'rgba(102, 126, 234, 0.2)',
                    borderColor: '#667eea',
                    borderWidth: 2,
                    pointBackgroundColor: '#667eea'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        angleLines: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        pointLabels: {
                            color: '#fff'
                        },
                        ticks: {
                            color: '#ccc',
                            backdropColor: 'transparent'
                        },
                        min: 0,
                        max: 100
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#fff'
                        }
                    }
                }
            }
        });
    }

    // Generate area chart for time spent by month
    function generateAreaChart() {
        const ctx = document.getElementById('areaChart').getContext('2d');
        
        // Simulate time spent by month (Jan 2026)
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Maj', 'Jun', 'Jul', 'Avg', 'Sep', 'Okt', 'Nov', 'Dec'];
        const timeByMonth = [120, 95, 110, 85, 130, 115, 105, 140, 125, 110, 135, 120]; // Sample data
        
        if (areaChart) areaChart.destroy();
        
        areaChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: months,
                datasets: [{
                    label: 'Utrošeno vrijeme (h)',
                    data: timeByMonth,
                    backgroundColor: 'rgba(0, 255, 136, 0.2)',
                    borderColor: '#00ff88',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            color: '#ccc'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    },
                    x: {
                        ticks: {
                            color: '#ccc'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#fff'
                        }
                    }
                }
            }
        });
    }

    // Generate scatter chart for budget vs time
    function generateScatterChart() {
        const ctx = document.getElementById('scatterChart').getContext('2d');
        
        // Prepare data for scatter plot
        const scatterData = projects.map(p => {
            const timeSpent = p.timeSpent ? p.timeSpent.reduce((sum, entry) => sum + entry.hours, 0) : 0;
            const budget = p.budget || 0;
            const progress = p.progress;
            
            return {
                x: budget,
                y: timeSpent,
                progress: progress
            };
        });
        
        if (scatterChart) scatterChart.destroy();
        
        scatterChart = new Chart(ctx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Projekti',
                    data: scatterData,
                    backgroundColor: scatterData.map(d => {
                        if (d.progress >= 80) return 'rgba(0, 255, 136, 0.7)';
                        if (d.progress >= 50) return 'rgba(255, 170, 0, 0.7)';
                        return 'rgba(255, 85, 85, 0.7)';
                    }),
                    borderColor: scatterData.map(d => {
                        if (d.progress >= 80) return '#00ff88';
                        if (d.progress >= 50) return '#ffaa00';
                        return '#ff5555';
                    }),
                    borderWidth: 1,
                    pointRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Utrošeno vrijeme (h)',
                            color: '#ccc'
                        },
                        ticks: {
                            color: '#ccc'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    },
                    x: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Budžet (€)',
                            color: '#ccc'
                        },
                        ticks: {
                            color: '#ccc'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#fff'
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const point = context.raw;
                                const project = projects.find(p => {
                                    const timeSpent = p.timeSpent ? p.timeSpent.reduce((sum, entry) => sum + entry.hours, 0) : 0;
                                    const budget = p.budget || 0;
                                    return Math.abs(timeSpent - point.y) < 0.1 && Math.abs(budget - point.x) < 0.1;
                                });
                                
                                if (project) {
                                    return [
                                        `Projekt: ${project.name}`,
                                        `Budžet: ${point.x} €`,
                                        `Vrijeme: ${point.y}h`,
                                        `Napredak: ${point.progress}%`
                                    ];
                                }
                                return `Budžet: ${point.x} €, Vrijeme: ${point.y}h`;
                            }
                        }
                    }
                }
            }
        });
    }

    // Generate pie chart for project priorities
    function generatePieChart() {
        const ctx = document.getElementById('pieChart').getContext('2d');
        
        // Count projects by priority
        const priorityCount = {
            'Visok': 0,
            'Srednji': 0,
            'Nizak': 0
        };
        
        projects.forEach(project => {
            const priority = project.priority || 'Srednji';
            if (priority === 'high') priorityCount['Visok']++;
            else if (priority === 'medium') priorityCount['Srednji']++;
            else if (priority === 'low') priorityCount['Nizak']++;
        });
        
        const labels = Object.keys(priorityCount);
        const data = Object.values(priorityCount);
        
        if (pieChart) pieChart.destroy();
        
        pieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: [
                        'rgba(255, 85, 85, 0.7)',
                        'rgba(255, 170, 0, 0.7)',
                        'rgba(0, 255, 136, 0.7)'
                    ],
                    borderColor: [
                        '#ff5555',
                        '#ffaa00',
                        '#00ff88'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: '#fff',
                            font: {
                                size: 11
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `${label}: ${value} projekata (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });
    }

    // Generate gauge chart for client satisfaction
    function generateGaugeChart() {
        const ctx = document.getElementById('gaugeChart').getContext('2d');
        
        // Calculate average client satisfaction
        const avgSatisfaction = projects.length > 0 ? 
            projects.reduce((sum, p) => sum + (p.satisfaction || 5), 0) / projects.length : 5;
        
        if (gaugeChart) gaugeChart.destroy();
        
        // Create a custom gauge chart using a doughnut chart
        gaugeChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [avgSatisfaction, 10 - avgSatisfaction],
                    backgroundColor: [
                        getSatisfactionColor(avgSatisfaction),
                        'rgba(255, 255, 255, 0.1)'
                    ],
                    borderWidth: 0,
                    circumference: 180,
                    rotation: 270
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '80%',
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        enabled: false
                    }
                }
            }
        });
        
        // Add text in the center
        const canvas = document.getElementById('gaugeChart');
        const centerText = avgSatisfaction.toFixed(1);
        
        // We'll update the chart with annotation plugin (simplified version)
        Chart.register({
            id: 'gaugeText',
            afterDraw: function(chart) {
                const ctx = chart.ctx;
                const width = chart.width;
                const height = chart.height;
                
                ctx.save();
                ctx.font = '24px Arial';
                ctx.fillStyle = '#fff';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(centerText, width / 2, height / 2 + 10);
                
                ctx.font = '12px Arial';
                ctx.fillStyle = '#aaa';
                ctx.fillText('Zadovoljstvo', width / 2, height / 2 - 15);
                ctx.fillText('(1-10)', width / 2, height / 2 + 30);
                
                ctx.restore();
            }
        });
        
        // Update the chart to show the text
        gaugeChart.update();
    }

    // Get color based on satisfaction level
    function getSatisfactionColor(level) {
        if (level >= 8) return '#00ff88';
        if (level >= 6) return '#ffaa00';
        return '#ff5555';
    }

    // Populate dashboard metrics
    function populateDashboardMetrics() {
        // Calculate total budget
        const totalBudget = projects.reduce((sum, p) => sum + (p.budget || 0), 0);
        dashboardTotalBudget.textContent = `${totalBudget.toLocaleString()} €`;
        
        // Calculate average time per project
        const totalTime = projects.reduce((sum, p) => {
            return sum + (p.timeSpent ? p.timeSpent.reduce((s, e) => s + e.hours, 0) : 0);
        }, 0);
        const avgTime = projects.length > 0 ? (totalTime / projects.length).toFixed(1) : 0;
        dashboardAvgTime.textContent = `${avgTime}h`;
        
        // Calculate total team size
        const totalTeam = projects.reduce((sum, p) => sum + (p.teamSize || 0), 0);
        dashboardTotalTeam.textContent = totalTeam;
        
        // Calculate average complexity
        const avgComplexity = projects.length > 0 ? 
            (projects.reduce((sum, p) => sum + (p.complexity || 5), 0) / projects.length).toFixed(1) : 0;
        dashboardAvgComplexity.textContent = avgComplexity;
    }

    // Populate dashboard projects table
    function populateDashboardProjectsTable() {
        dashboardProjectsTable.innerHTML = '';
        
        projects.forEach(project => {
            const row = document.createElement('tr');
            const timeSpent = project.timeSpent ? project.timeSpent.reduce((sum, entry) => sum + entry.hours, 0) : 0;
            
            row.innerHTML = `
                <td>${project.name}</td>
                <td><span class="category-tag ${getCategoryClass(project.category)}">${project.category}</span></td>
                <td>${project.budget ? project.budget.toLocaleString() + ' €' : 'N/A'}</td>
                <td>${project.teamSize || 'N/A'}</td>
                <td>${getPriorityText(project.priority)}</td>
                <td>${getRiskText(project.riskLevel)}</td>
                <td>${project.satisfaction || 'N/A'}</td>
                <td>${project.complexity || 'N/A'}</td>
            `;
            
            dashboardProjectsTable.appendChild(row);
        });
    }

    // Get priority text
    function getPriorityText(priority) {
        if (priority === 'high') return 'Visok';
        if (priority === 'medium') return 'Srednji';
        if (priority === 'low') return 'Nizak';
        return 'N/A';
    }

    // Get risk text
    function getRiskText(risk) {
        if (risk === 'high') return 'Visok';
        if (risk === 'medium') return 'Srednji';
        if (risk === 'low') return 'Nizak';
        return 'N/A';
    }

    // Populate comparison dropdowns
    function populateComparisonDropdowns() {
        compareProject1.innerHTML = '<option value="">Odaberi projekt 1</option>';
        compareProject2.innerHTML = '<option value="">Odaberi projekt 2</option>';
        
        projects.forEach(project => {
            const option1 = document.createElement('option');
            option1.value = project.id;
            option1.textContent = project.name;
            
            const option2 = document.createElement('option');
            option2.value = project.id;
            option2.textContent = project.name;
            
            compareProject1.appendChild(option1.cloneNode(true));
            compareProject2.appendChild(option2.cloneNode(true));
        });
    }

    // Compare projects
    function compareProjects() {
        const project1Id = parseInt(compareProject1.value);
        const project2Id = parseInt(compareProject2.value);
        
        if (!project1Id || !project2Id) {
            showToast('Odaberite oba projekta za poređenje!', 'warning');
            return;
        }
        
        if (project1Id === project2Id) {
            showToast('Odaberite različite projekte za poređenje!', 'warning');
            return;
        }
        
        const project1 = projects.find(p => p.id === project1Id);
        const project2 = projects.find(p => p.id === project2Id);
        
        if (!project1 || !project2) {
            showToast('Projekti nisu pronađeni!', 'error');
            return;
        }
        
        // Generate comparison charts
        generateComparisonBarChart(project1, project2);
        generateComparisonLineChart(project1, project2);
        
        // Populate comparison metrics
        populateComparisonMetrics(project1, project2);
    }

    // Generate comparison bar chart
    function generateComparisonBarChart(project1, project2) {
        const ctx = document.getElementById('comparisonBarChart').getContext('2d');
        
        const timeSpent1 = project1.timeSpent ? project1.timeSpent.reduce((sum, entry) => sum + entry.hours, 0) : 0;
        const timeSpent2 = project2.timeSpent ? project2.timeSpent.reduce((sum, entry) => sum + entry.hours, 0) : 0;
        
        if (comparisonBarChart) comparisonBarChart.destroy();
        
        comparisonBarChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Budžet (€)', 'Utrošeno vrijeme (h)', 'Napredak (%)', 'Zadovoljstvo'],
                datasets: [
                    {
                        label: project1.name.substring(0, 20) + (project1.name.length > 20 ? '...' : ''),
                        data: [
                            project1.budget || 0,
                            timeSpent1,
                            project1.progress,
                            (project1.satisfaction || 5) * 10
                        ],
                        backgroundColor: 'rgba(102, 126, 234, 0.7)',
                        borderColor: '#667eea',
                        borderWidth: 1
                    },
                    {
                        label: project2.name.substring(0, 20) + (project2.name.length > 20 ? '...' : ''),
                        data: [
                            project2.budget || 0,
                            timeSpent2,
                            project2.progress,
                            (project2.satisfaction || 5) * 10
                        ],
                        backgroundColor: 'rgba(0, 255, 136, 0.7)',
                        borderColor: '#00ff88',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            color: '#ccc'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    },
                    x: {
                        ticks: {
                            color: '#ccc'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#fff'
                        }
                    }
                }
            }
        });
    }

    // Generate comparison line chart
    function generateComparisonLineChart(project1, project2) {
        const ctx = document.getElementById('comparisonLineChart').getContext('2d');
        
        // Simulate progress over time (last 6 months)
        const months = ['Jul', 'Avg', 'Sep', 'Okt', 'Nov', 'Dec', 'Jan'];
        
        // Generate simulated progress data
        const progress1 = [10, 20, 35, 50, 65, 80, project1.progress];
        const progress2 = [5, 15, 30, 45, 60, 75, project2.progress];
        
        if (comparisonLineChart) comparisonLineChart.destroy();
        
        comparisonLineChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: months,
                datasets: [
                    {
                        label: project1.name.substring(0, 20) + (project1.name.length > 20 ? '...' : ''),
                        data: progress1,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: project2.name.substring(0, 20) + (project2.name.length > 20 ? '...' : ''),
                        data: progress2,
                        borderColor: '#00ff88',
                        backgroundColor: 'rgba(0, 255, 136, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            color: '#ccc'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    },
                    x: {
                        ticks: {
                            color: '#ccc'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#fff'
                        }
                    }
                }
            }
        });
    }

    // Populate comparison metrics
    function populateComparisonMetrics(project1, project2) {
        const timeSpent1 = project1.timeSpent ? project1.timeSpent.reduce((sum, entry) => sum + entry.hours, 0) : 0;
        const timeSpent2 = project2.timeSpent ? project2.timeSpent.reduce((sum, entry) => sum + entry.hours, 0) : 0;
        
        // Calculate efficiency (progress per hour)
        const efficiency1 = project1.progress > 0 ? (project1.progress / timeSpent1).toFixed(2) : 0;
        const efficiency2 = project2.progress > 0 ? (project2.progress / timeSpent2).toFixed(2) : 0;
        
        comparisonMetrics.innerHTML = `
            <div class="metric-card">
                <h4>${project1.name}</h4>
                <div class="metric-value">${project1.progress}%</div>
                <div class="metric-label">NAPREMAK</div>
            </div>
            <div class="metric-card">
                <h4>${project2.name}</h4>
                <div class="metric-value">${project2.progress}%</div>
                <div class="metric-label">NAPREMAK</div>
            </div>
            <div class="metric-card">
                <h4>Efikasnost (napredak/h)</h4>
                <div class="metric-value">${efficiency1 > efficiency2 ? efficiency1 + ' vs ' + efficiency2 : efficiency2 + ' vs ' + efficiency1}</div>
                <div class="metric-label">${efficiency1 > efficiency2 ? project1.name.substring(0, 10) + '...' : project2.name.substring(0, 10) + '...'} BOLJI</div>
            </div>
            <div class="metric-card">
                <h4>Budžet iskorištenost</h4>
                <div class="metric-value">${project1.budget && project2.budget ? 
                    ((timeSpent1 * 50) / project1.budget * 100).toFixed(1) + '% vs ' + 
                    ((timeSpent2 * 50) / project2.budget * 100).toFixed(1) + '%' : 'N/A'}</div>
                <div class="metric-label">TROŠKOVI PO SATU (50€)</div>
            </div>
        `;
    }

    // Generate dashboard AI analysis - UPDATED with heuristic algorithms
    function generateDashboardAIAnalysis() {
        if (projects.length === 0) {
            dashboardAIAnalysis.textContent = "Nemate kreiranih projekata. Kreirajte prvi projekt da biste vidjeli analizu.";
            return;
        }
        
        let analysis = "🤖 AI ANALIZA (heuristički algoritmi):\n\n";
        
        // 1. Budget Burn Rate Analysis
        const totalBudget = projects.reduce((sum, p) => sum + (p.budget || 0), 0);
        const totalTimeSpent = projects.reduce((sum, p) => {
            return sum + (p.timeSpent ? p.timeSpent.reduce((s, e) => s + e.hours, 0) : 0);
        }, 0);
        
        const hourlyRate = 50; // Pretpostavljena satnica
        const burnRate = totalTimeSpent * hourlyRate;
        const burnRatePercentage = totalBudget > 0 ? (burnRate / totalBudget) * 100 : 0;
        
        analysis += `📊 STOPA SAGORIJEVANJA BUDŽETA: ${burnRatePercentage.toFixed(1)}% (utrošeno ${burnRate.toFixed(0)}€ od ${totalBudget}€)\n`;
        if (burnRatePercentage > 90) {
            analysis += "   🔴 KRITIČNO: Previsoka stopa sagorijevanja! Hitno optimizirajte resurse.\n";
        } else if (burnRatePercentage > 70) {
            analysis += "   🟡 UP0ZORENJE: Visoka stopa sagorijevanja. Razmotrite smanjenje troškova.\n";
        } else if (burnRatePercentage > 40) {
            analysis += "   🟢 STABILNO: Umjerena stopa sagorijevanja. Nastavite sa trenutnim tempom.\n";
        } else {
            analysis += "   🟢 IZVRSNO: Niska stopa sagorijevanja. Efikasno upravljanje resursima.\n";
        }
        
        analysis += "\n";
        
        // 2. Team Productivity (Progress vs Time Spent)
        let productivityData = [];
        projects.forEach(project => {
            const time = project.timeSpent ? project.timeSpent.reduce((sum, entry) => sum + entry.hours, 0) : 0;
            if (time > 0 && project.progress > 0) {
                const productivity = (project.progress / time) * 100; // % napretka po satu
                productivityData.push({
                    name: project.name,
                    productivity: productivity,
                    progress: project.progress,
                    time: time
                });
            }
        });
        
        if (productivityData.length > 0) {
            productivityData.sort((a, b) => a.productivity - b.productivity);
            
            analysis += "📈 PRODUKTIVNOST TIMA:\n";
            const avgProductivity = productivityData.reduce((sum, item) => sum + item.productivity, 0) / productivityData.length;
            
            // Heuristika: < 0.5% po satu = loše, 0.5-1% = srednje, > 1% = odlično
            if (avgProductivity < 0.5) {
                analysis += `   ⚠️ Niska produktivnost (${avgProductivity.toFixed(2)}% napretka/sat)\n`;
                analysis += "   Preporuka: Fokusirajte se na blokere, smanjite sastanke, optimizirajte procese.\n";
            } else if (avgProductivity < 1.0) {
                analysis += `   ✅ Solidna produktivnost (${avgProductivity.toFixed(2)}% napretka/sat)\n`;
            } else {
                analysis += `   🎉 Odlična produktivnost (${avgProductivity.toFixed(2)}% napretka/sat)\n`;
            }
            
            // Identifikuj najmanje produktivan projekt
            if (productivityData.length > 1 && productivityData[0].productivity < 0.3) {
                analysis += `   🎯 Fokus: Projekt "${productivityData[0].name}" zahtijeva pažnju (samo ${productivityData[0].productivity.toFixed(2)}% napretka/sat)\n`;
            }
        }
        
        analysis += "\n";
        
        // 3. Critical Projects (approaching deadlines or behind schedule)
        const today = new Date(2026, 0, 15);
        let criticalCount = 0;
        let deadlineProjects = [];
        
        projects.forEach(project => {
            if (project.status !== 'running') return;
            
            const endDate = new Date(project.end);
            const daysUntilDeadline = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
            
            // Heuristika za kritičnost
            const isCritical = daysUntilDeadline < 14 || // Manje od 2 sedmice
                              (daysUntilDeadline < 30 && project.progress < 30) || // Manje od mjesec dana i mali napredak
                              (project.progress < 20 && daysUntilDeadline < 60); // Vrlo mali napredak
            
            if (isCritical) {
                criticalCount++;
                deadlineProjects.push({
                    name: project.name,
                    days: daysUntilDeadline,
                    progress: project.progress
                });
            }
        });
        
        if (criticalCount > 0) {
            analysis += `🚨 KRITIČNI PROJEKTI (${criticalCount} od ${projects.length}):\n`;
            deadlineProjects.sort((a, b) => a.days - b.days).forEach(p => {
                let urgency = "";
                if (p.days < 7) urgency = "🔴 HITNO";
                else if (p.days < 14) urgency = "🟡 URGENTNO";
                else urgency = "🟢 PAŽNJA";
                
                analysis += `   ${urgency} ${p.name}: ${p.days} dana do roka, napredak ${p.progress}%\n`;
            });
            
            // Preporuke za kritične projekte
            if (criticalCount > projects.length * 0.5) {
                analysis += "   ⚠️ PREVIŠE KRITIČNIH: Razmotrite redistribuciju resursa ili produženje rokova.\n";
            }
        } else {
            analysis += "✅ Nema kritičnih projekata. Svi projekti su u dobrom stanju.\n";
        }
        
        analysis += "\n";
        
        // 4. Habit Consistency vs Project Progress Correlation
        if (habits.length > 0 && projects.length > 0) {
            analysis += "🔄 KONZISTENTNOST NAVIKA I NAPREDAK PROJEKATA:\n";
            
            // Grupiši navike po projektima
            const habitsByProject = {};
            habits.forEach(habit => {
                if (habit.projectId) {
                    if (!habitsByProject[habit.projectId]) {
                        habitsByProject[habit.projectId] = [];
                    }
                    habitsByProject[habit.projectId].push(habit);
                }
            });
            
            // Analiziraj korelaciju za svaki projekt
            let highCorrelationCount = 0;
            let lowCorrelationCount = 0;
            
            Object.keys(habitsByProject).forEach(projectId => {
                const projectHabits = habitsByProject[projectId];
                let totalCompletion = 0;
                
                // Izračunaj prosječnu konzistentnost za januar
                projectHabits.forEach(habit => {
                    let completedDays = 0;
                    for (let day = 1; day <= 15; day++) { // Samo prva polovina januara
                        const dateStr = `2026-01-${String(day).padStart(2, '0')}`;
                        if (habit.days && habit.days[dateStr]) {
                            completedDays++;
                        }
                    }
                    totalCompletion += (completedDays / 15) * 100;
                });
                
                const avgHabitCompletion = totalCompletion / projectHabits.length;
                const project = projects.find(p => p.id == projectId);
                
                if (project) {
                    // Heuristika za korelaciju
                    if (avgHabitCompletion > 70 && project.progress > 50) {
                        highCorrelationCount++;
                    } else if (avgHabitCompletion < 30 && project.progress < 30) {
                        lowCorrelationCount++;
                    }
                }
            });
            
            if (highCorrelationCount > 0) {
                analysis += `   ✅ ${highCorrelationCount} projekta pokazuju visoku korelaciju između konzistentnosti navika i napretka.\n`;
                analysis += "   Dokazano: Redovno praćenje navika pozitivno utiče na ishode projekata.\n";
            }
            
            if (lowCorrelationCount > 0) {
                analysis += `   ⚠️ ${lowCorrelationCount} projekta imaju nisku konzistentnost navika i mali napredak.\n`;
                analysis += "   Preporuka: Poboljšajte praćenje dnevnih zadataka za ove projekte.\n";
            }
            
            // Ukupna preporuka
            if (habits.length < projects.length * 2) {
                analysis += "   💡 SAVJET: Dodajte više navika za praćenje specifičnih projektnih aktivnosti.\n";
            }
        }
        
        // 5. Preporuke za balansiranje resursa
        analysis += "\n🎯 PREPORUKE ZA OPTIMIZACIJU:\n";
        
        // Analiza raspodjele resursa
        const activeProjects = projects.filter(p => p.status === 'running').length;
        const totalTeamSize = projects.reduce((sum, p) => sum + (p.teamSize || 1), 0);
        
        if (activeProjects > 0 && totalTeamSize > 0) {
            const avgTeamPerProject = totalTeamSize / activeProjects;
            
            if (avgTeamPerProject < 2) {
                analysis += "   1. 📊 Premalo ljudi po projektu - razmislite o angažmanu dodatnih resursa\n";
            } else if (avgTeamPerProject > 5) {
                analysis += "   1. 📊 Previše ljudi po projektu - razmislite o redistribuciji timova\n";
            } else {
                analysis += "   1. 📊 Dobra raspodjela timova - nastavite sa trenutnom strategijom\n";
            }
        }
        
        // Preporuka bazirana na kompleksnosti
        const highComplexityProjects = projects.filter(p => p.complexity && p.complexity >= 8);
        if (highComplexityProjects.length > 0) {
            analysis += `   2. 🧩 ${highComplexityProjects.length} visoko-kompleksna projekta - dodijelite iskusnije timove\n`;
        }
        
        // Preporuka za rokove
        const nearingDeadline = projects.filter(p => {
            if (p.status !== 'running') return false;
            const endDate = new Date(p.end);
            const daysLeft = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
            return daysLeft < 30 && p.progress < 70;
        });
        
        if (nearingDeadline.length > 0) {
            analysis += `   3. ⏰ ${nearingDeadline.length} projekta bliže rokovima - prioritizirajte ove projekte\n`;
        }
        
        dashboardAIAnalysis.textContent = analysis;
    }

    // Export dashboard charts
    function exportDashboardCharts() {
        showToast('Generisanje izvještaja sa grafikona...', 'info');
        
        // In a real implementation, this would generate a PDF with all charts
        setTimeout(() => {
            showToast('Izvještaj sa grafikona je spreman za preuzimanje!', 'success');
        }, 2000);
    }

    // Edit project - open modal with project data
    function editProject(projectId) {
        const project = projects.find(p => p.id === projectId);
        if (!project) {
            showToast('Projekt nije pronađen!', 'error');
            return;
        }
        
        editingProjectId = projectId;
        
        // Set modal title
        modalProjectTitle.textContent = 'Uredi projekt';
        submitProjectBtn.textContent = 'Spremi promjene';
        
        // Fill form with project data
        document.getElementById('projectId').value = project.id;
        document.getElementById('projectName').value = project.name;
        document.getElementById('projectDescription').value = project.description || '';
        document.getElementById('projectCategory').value = project.category;
        document.getElementById('projectStart').value = project.start.slice(0, 16);
        document.getElementById('projectEnd').value = project.end.slice(0, 16);
        document.getElementById('projectProgress').value = project.progress;
        document.getElementById('projectStatus').value = project.status;
        progressValue.textContent = project.progress + '%';
        
        // Fill metrics tab
        document.getElementById('projectBudget').value = project.budget || '';
        document.getElementById('projectTeamSize').value = project.teamSize || '';
        document.getElementById('projectPriority').value = project.priority || 'medium';
        document.getElementById('projectRiskLevel').value = project.riskLevel || 'medium';
        document.getElementById('projectSatisfaction').value = project.satisfaction || 5;
        document.getElementById('projectComplexity').value = project.complexity || 5;
        satisfactionValue.textContent = project.satisfaction || 5;
        complexityValue.textContent = project.complexity || 5;
        
        // Fill advanced tab
        document.getElementById('projectTags').value = project.tags || '';
        document.getElementById('projectClient').value = project.client || '';
        document.getElementById('projectStakeholders').value = project.stakeholders || '';
        document.getElementById('projectTechnology').value = project.technology || '';
        
        // Populate dependencies dropdown
        const dependenciesSelect = document.getElementById('projectDependencies');
        dependenciesSelect.innerHTML = '';
        projects.filter(p => p.id !== projectId).forEach(p => {
            const option = document.createElement('option');
            option.value = p.id;
            option.textContent = p.name;
            option.selected = project.dependencies && project.dependencies.includes(p.id);
            dependenciesSelect.appendChild(option);
        });
        
        // Show modal
        projectModal.style.display = 'flex';
        
        // Activate basic tab
        document.querySelectorAll('#projectModal .modal-tab').forEach(t => t.classList.remove('active'));
        document.querySelector('#projectModal .modal-tab[data-tab="basic"]').classList.add('active');
        
        document.querySelectorAll('#projectModal .tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById('basicTab').classList.add('active');
    }

    // Complete project - mark as completed
    function completeProject(projectId) {
        const project = projects.find(p => p.id === projectId);
        if (!project) {
            showToast('Projekt nije pronađen!', 'error');
            return;
        }
        
        if (project.status === 'completed') {
            // Ask if user wants to reopen
            if (confirm('Projekt je već završen. Da li želite da ga vratite u aktivne?')) {
                project.status = 'running';
                project.progress = 70; // Set to 70% when reopening
                saveData();
                renderProjects();
                updateKPICards();
                showToast(`Projekt "${project.name}" vraćen u aktivne!`, 'info');
            }
        } else {
            project.status = 'completed';
            project.progress = 100;
            saveData();
            renderProjects();
            updateKPICards();
            showToast(`Projekt "${project.name}" označen kao završen!`, 'success');
        }
    }

    // Helper functions
    function getRandomColor() {
        const colors = ['#667eea', '#764ba2', '#00ff88', '#ffaa00', '#ff55ff', '#00ffff', '#ff5555', '#9b59b6'];
        return colors[Math.floor(Math.random() * colors.length)];
    }

    // Update KPI cards with time spent
    function updateKPICards() {
        // Project stats
        const total = projects.length;
        const running = projects.filter(p => p.status === 'running').length;
        const upcoming = projects.filter(p => p.status === 'upcoming').length;
        
        // Calculate active tasks (subprojects)
        let activeTasks = 0;
        projects.forEach(project => {
            if (project.subprojects) {
                activeTasks += project.subprojects.length;
            }
        });
        
        // Calculate total time spent
        let totalTimeSpent = 0;
        projects.forEach(project => {
            if (project.timeSpent) {
                totalTimeSpent += project.timeSpent.reduce((sum, entry) => sum + entry.hours, 0);
            }
        });
        
        // Calculate average time per project
        const avgTime = total > 0 ? (totalTimeSpent / total).toFixed(1) : 0;
        
        // Calculate weekly progress from habits
        let weeklyProgress = 0;
        if (habits.length > 0) {
            const today = new Date(2026, 0, 15); // Fixed for demo
            const weekStart = new Date(today);
            weekStart.setDate(weekStart.getDate() - weekStart.getDay() + 1);
            let weekCompleted = 0;
            let weekTotal = 0;
            
            habits.forEach(habit => {
                for (let i = 0; i < 7; i++) {
                    const date = new Date(weekStart);
                    date.setDate(date.getDate() + i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    weekTotal++;
                    if (habit.days && habit.days[dateStr]) {
                        weekCompleted++;
                    }
                }
            });
            
            weeklyProgress = weekTotal > 0 ? Math.round((weekCompleted / weekTotal) * 100) : 0;
        }
        
        // Update KPI cards
        document.getElementById('totalProjects').textContent = total;
        document.getElementById('runningProjects').textContent = running;
        document.getElementById('inProgress').textContent = activeTasks;
        document.getElementById('timeSpent').textContent = `${totalTimeSpent}h`;
        document.getElementById('avgTime').textContent = `${avgTime}h`;
        document.getElementById('weeklyProgress').textContent = `${weeklyProgress}%`;
    }

    // Show toast notification
    function showToast(message, type = 'info') {
        const toastContainer = document.getElementById('toastContainer');
        
        // Create toast element
        const toast = document.createElement('div');
        toast.className = 'toast';
        
        // Set icon based on type
        let icon = '💡';
        if (type === 'success') icon = '✅';
        if (type === 'warning') icon = '⚠️';
        if (type === 'error') icon = '❌';
        if (type === 'info') icon = 'ℹ️';
        
        toast.innerHTML = `
            <span style="font-size: 18px;">${icon}</span>
            <span>${message}</span>
        `;
        
        toastContainer.appendChild(toast);
        
        // Auto remove after 3 seconds
        setTimeout(() => {
            toast.remove();
        }, 3000);
    }

    // Initialize event listeners
    function initEventListeners() {
        // Project filter
        projectFilter.addEventListener('change', renderProjects);
        
        // Dashboard button
        dashboardBtn.addEventListener('click', openDashboardModal);
        
        // Export buttons
        exportExcelBtn.addEventListener('click', exportToExcel);
        exportPdfBtn.addEventListener('click', exportToPdf);
        clearAllBtn.addEventListener('click', clearAllData);
        
        // Add/edit project modal
        addProjectBtn.addEventListener('click', () => {
            editingProjectId = null;
            modalProjectTitle.textContent = 'Novi projekt';
            submitProjectBtn.textContent = 'Dodaj projekt';
            projectForm.reset();
            progressValue.textContent = '0%';
            satisfactionValue.textContent = '5';
            complexityValue.textContent = '5';
            setDefaultDateTimeValues();
            
            // Reset dependencies dropdown
            const dependenciesSelect = document.getElementById('projectDependencies');
            dependenciesSelect.innerHTML = '';
            projects.forEach(p => {
                const option = document.createElement('option');
                option.value = p.id;
                option.textContent = p.name;
                dependenciesSelect.appendChild(option);
            });
            
            // Activate basic tab
            document.querySelectorAll('#projectModal .modal-tab').forEach(t => t.classList.remove('active'));
            document.querySelector('#projectModal .modal-tab[data-tab="basic"]').classList.add('active');
            
            document.querySelectorAll('#projectModal .tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('basicTab').classList.add('active');
            
            projectModal.style.display = 'flex';
        });
        
        // Cancel project
        cancelProjectBtn.addEventListener('click', () => {
            projectModal.style.display = 'none';
            projectForm.reset();
            progressValue.textContent = '0%';
            satisfactionValue.textContent = '5';
            complexityValue.textContent = '5';
            setDefaultDateTimeValues();
        });
        
        // Project progress slider
        projectProgress.addEventListener('input', function() {
            progressValue.textContent = this.value + '%';
        });
        
        // Satisfaction slider
        projectSatisfaction.addEventListener('input', function() {
            satisfactionValue.textContent = this.value;
        });
        
        // Complexity slider
        projectComplexity.addEventListener('input', function() {
            complexityValue.textContent = this.value;
        });
        
        // Submit project form (add or edit)
        projectForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form values from all tabs
            const id = document.getElementById('projectId').value;
            const name = document.getElementById('projectName').value;
            const description = document.getElementById('projectDescription').value;
            const category = document.getElementById('projectCategory').value;
            const start = document.getElementById('projectStart').value;
            const end = document.getElementById('projectEnd').value;
            const progress = parseInt(document.getElementById('projectProgress').value);
            const status = document.getElementById('projectStatus').value;
            
            // Metrics tab values
            const budget = document.getElementById('projectBudget').value ? parseInt(document.getElementById('projectBudget').value) : 0;
            const teamSize = document.getElementById('projectTeamSize').value ? parseInt(document.getElementById('projectTeamSize').value) : 1;
            const priority = document.getElementById('projectPriority').value;
            const riskLevel = document.getElementById('projectRiskLevel').value;
            const satisfaction = parseInt(document.getElementById('projectSatisfaction').value);
            const complexity = parseInt(document.getElementById('projectComplexity').value);
            
            // Advanced tab values
            const tags = document.getElementById('projectTags').value;
            const client = document.getElementById('projectClient').value;
            const stakeholders = document.getElementById('projectStakeholders').value;
            const dependencies = Array.from(document.getElementById('projectDependencies').selectedOptions).map(option => parseInt(option.value));
            const technology = document.getElementById('projectTechnology').value;
            
            // Add category to set if it's new
            if (category && !categories.has(category)) {
                categories.add(category);
                updateCategorySuggestions();
            }
            
            if (editingProjectId) {
                // Update existing project
                const projectIndex = projects.findIndex(p => p.id == editingProjectId);
                if (projectIndex !== -1) {
                    projects[projectIndex].name = name;
                    projects[projectIndex].description = description;
                    projects[projectIndex].category = category;
                    projects[projectIndex].start = start;
                    projects[projectIndex].end = end;
                    projects[projectIndex].progress = progress;
                    projects[projectIndex].status = status;
                    
                    // Update metrics
                    projects[projectIndex].budget = budget;
                    projects[projectIndex].teamSize = teamSize;
                    projects[projectIndex].priority = priority;
                    projects[projectIndex].riskLevel = riskLevel;
                    projects[projectIndex].satisfaction = satisfaction;
                    projects[projectIndex].complexity = complexity;
                    
                    // Update advanced fields
                    projects[projectIndex].tags = tags;
                    projects[projectIndex].client = client;
                    projects[projectIndex].stakeholders = stakeholders;
                    projects[projectIndex].dependencies = dependencies;
                    projects[projectIndex].technology = technology;
                    
                    saveData();
                    
                    // Update UI
                    updateCalendarEvents();
                    renderProjects();
                    renderCalendar();
                    updateKPICards();
                    
                    // Close modal
                    projectModal.style.display = 'none';
                    projectForm.reset();
                    progressValue.textContent = '0%';
                    satisfactionValue.textContent = '5';
                    complexityValue.textContent = '5';
                    
                    showToast(`Projekt "${name}" ažuriran!`, 'success');
                }
            } else {
                // Create new project
                const newProject = {
                    id: Date.now(),
                    name,
                    description,
                    category,
                    start,
                    end,
                    progress,
                    status,
                    budget,
                    teamSize,
                    priority,
                    riskLevel,
                    satisfaction,
                    complexity,
                    tags,
                    client,
                    stakeholders,
                    dependencies,
                    technology,
                    timeSpent: [],
                    subprojects: [],
                    createdAt: new Date().toISOString()
                };
                
                projects.push(newProject);
                saveData();
                
                // Update UI
                updateCalendarEvents();
                renderProjects();
                renderCalendar();
                updateHabitProjectFilter();
                updateKPICards();
                
                // Close modal
                projectModal.style.display = 'none';
                projectForm.reset();
                progressValue.textContent = '0%';
                satisfactionValue.textContent = '5';
                complexityValue.textContent = '5';
                
                showToast(`Projekt "${name}" kreiran!`, 'success');
            }
        });
        
        // Sort buttons
        sortByDateBtn.addEventListener('click', () => {
            projects.sort((a, b) => new Date(a.start) - new Date(b.start));
            renderProjects();
            showToast('Projekti sortirani po datumu', 'info');
        });
        
        sortByProgressBtn.addEventListener('click', () => {
            projects.sort((a, b) => b.progress - a.progress);
            renderProjects();
            showToast('Projekti sortirani po napretku', 'info');
        });
        
        // Calendar navigation
        document.getElementById('prevMonth').addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        });
        
        document.getElementById('nextMonth').addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        });
        
        // Habit tracker controls
        habitProjectFilter.addEventListener('change', () => {
            renderImprovedHabitTracker();
        });
        
        habitMonthSelect.addEventListener('change', () => {
            currentHabitMonth = parseInt(habitMonthSelect.value);
            renderImprovedHabitTracker();
        });
        
        habitYearSelect.addEventListener('change', () => {
            currentHabitYear = parseInt(habitYearSelect.value);
            renderImprovedHabitTracker();
        });
        
        // Enter key for new habit
        newHabitTask.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                addHabitTask();
            }
        });
        
        // Subproject form
        subprojectForm.addEventListener('submit', addSubproject);
        
        // Interactive KPI cards
        Object.keys(kpiCards).forEach(kpiType => {
            kpiCards[kpiType].addEventListener('click', () => {
                // Add visual feedback
                kpiCards[kpiType].classList.add('clicked');
                setTimeout(() => {
                    kpiCards[kpiType].classList.remove('clicked');
                }, 300);
                
                // Open dashboard modal when clicking on KPI cards
                openDashboardModal();
            });
        });
        
        // Interactive stat cards
        Object.keys(statCards).forEach(statType => {
            statCards[statType].addEventListener('click', () => {
                // Add visual feedback
                statCards[statType].classList.add('active');
                setTimeout(() => {
                    statCards[statType].classList.remove('active');
                }, 300);
                
                // Open dashboard modal when clicking on stat cards
                openDashboardModal();
            });
        });
        
        // Close modals on outside click
        window.addEventListener('click', (e) => {
            if (e.target === projectModal) {
                projectModal.style.display = 'none';
                projectForm.reset();
                progressValue.textContent = '0%';
                satisfactionValue.textContent = '5';
                complexityValue.textContent = '5';
                setDefaultDateTimeValues();
            }
            if (e.target === dashboardModal) {
                closeDashboardModal();
            }
            if (e.target === subprojectModal) {
                closeSubprojectModal();
            }
            if (e.target === calendarDayModal) {
                closeCalendarDayModal();
            }
            if (e.target === timeTrackModal) {
                closeTimeTrackModal();
            }
        });
        
        // Set default datetime-local inputs
        const now = new Date(2026, 0, 15, 9, 0);
        const tomorrow = new Date(2026, 0, 30, 17, 0);
        
        document.getElementById('projectStart').min = "2026-01-01T00:00";
        document.getElementById('projectStart').max = "2026-12-31T23:59";
        document.getElementById('projectEnd').min = "2026-01-01T00:00";
        document.getElementById('projectEnd').max = "2026-12-31T23:59";
    }

    // Delete project
    function deleteProject(id) {
        if (!confirm('Obrisati ovaj projekt? Svi podprojekti i evidencija vremena će biti obrisani.')) return;
        
        const index = projects.findIndex(p => p.id === id);
        if (index !== -1) {
            const projectName = projects[index].name;
            
            // Also remove related habits
            habits = habits.filter(h => h.projectId !== id);
            
            // Remove from time tracking
            delete timeTracking[id];
            
            projects.splice(index, 1);
            saveData();
            
            updateCalendarEvents();
            renderProjects();
            renderCalendar();
            renderImprovedHabitTracker();
            updateKPICards();
            updateHabitProjectFilter();
            
            showToast(`Projekt "${projectName}" obrisan!`, 'info');
        }
    }

    // Clear all data
    function clearAllData() {
        if (!confirm('Da li ste sigurni da želite obrisati sve podatke? Ova akcija se ne može poništiti.')) return;
        
        projects = [];
        habits = [];
        timeTracking = {};
        calendarEvents = {};
        categories = new Set(['AGRO', 'ESP', 'Posao', 'Osobni', 'Edukacija', 'Zdravlje', 'Financije', 'Ostalo']);
        
        saveData();
        
        renderProjects();
        renderCalendar();
        renderImprovedHabitTracker();
        updateKPICards();
        updateHabitProjectFilter();
        updateCategorySuggestions();
        
        showToast('Svi podaci su obrisani!', 'info');
    }

    // Export to Excel
    function exportToExcel() {
        try {
            // Create workbook
            const wb = XLSX.utils.book_new();
            
            // Projects sheet
            const projectsData = [
                ['Projekt', 'Kategorija', 'Opis', 'Početak', 'Završetak', 'Napredak', 'Status', 'Budžet', 'Tim', 'Prioritet', 'Rizik', 'Zadovoljstvo', 'Kompleksnost', 'Podprojekti', 'Utrošeno vrijeme (h)'],
                ...projects.map(p => {
                    const totalTime = p.timeSpent ? p.timeSpent.reduce((sum, entry) => sum + entry.hours, 0) : 0;
                    return [
                        p.name,
                        p.category,
                        p.description || '',
                        new Date(p.start).toLocaleString('hr-HR'),
                        new Date(p.end).toLocaleString('hr-HR'),
                        p.progress + '%',
                        p.status === 'running' ? 'Aktivan' : p.status === 'upcoming' ? 'Nadolazeći' : 'Završen',
                        p.budget || 0,
                        p.teamSize || 1,
                        p.priority || 'Srednji',
                        p.riskLevel || 'Srednji',
                        p.satisfaction || 5,
                        p.complexity || 5,
                        p.subprojects ? p.subprojects.length : 0,
                        totalTime
                    ];
                })
            ];
            
            const projectsSheet = XLSX.utils.aoa_to_sheet(projectsData);
            XLSX.utils.book_append_sheet(wb, projectsSheet, 'Projekti');
            
            // Habits sheet
            const habitsData = [
                ['Zadatak', 'Opis', 'Kategorija', 'Projekt', 'Kreiran', 'Završeno dana', 'Posljednji datum'],
                ...habits.map(h => {
                    const days = Object.keys(h.days || {});
                    const lastDate = days.length > 0 ? days[days.length - 1] : 'Nikad';
                    return [
                        h.name,
                        h.description || '',
                        h.category,
                        h.projectName || 'Svi',
                        h.created || 'Nepoznato',
                        days.length,
                        lastDate
                    ];
                })
            ];
            
            const habitsSheet = XLSX.utils.aoa_to_sheet(habitsData);
            XLSX.utils.book_append_sheet(wb, habitsSheet, 'Habit Tracker');
            
            // Time tracking sheet
            const timeEntries = [];
            projects.forEach(project => {
                if (project.timeSpent) {
                    project.timeSpent.forEach(entry => {
                        timeEntries.push([
                            project.name,
                            entry.date,
                            entry.hours,
                            entry.description || '',
                            new Date(entry.timestamp).toLocaleString('hr-HR')
                        ]);
                    });
                }
            });
            
            if (timeEntries.length > 0) {
                const timeData = [
                    ['Projekt', 'Datum', 'Sati', 'Opis', 'Datum unosa'],
                    ...timeEntries
                ];
                const timeSheet = XLSX.utils.aoa_to_sheet(timeData);
                XLSX.utils.book_append_sheet(wb, timeSheet, 'Evidencija vremena');
            }
            
            // Save file
            const fileName = `Project_Export_${new Date().toISOString().slice(0,10)}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showToast('Excel fajl preuzet!', 'success');
            
            return true;
        } catch (error) {
            console.error('Excel export error:', error);
            showToast('Greška pri Excel exportu!', 'error');
            return false;
        }
    }

    // Export to PDF
    function exportToPdf() {
        showToast('PDF izvještaj se generiše...', 'info');
        
        // Simulate PDF generation
        setTimeout(() => {
            showToast('PDF izvještaj preuzet!', 'success');
        }, 1500);
    }

    // Add task to day in calendar
    function addTaskToDay() {
        const taskName = document.getElementById('newTaskName').value.trim();
        const projectId = parseInt(document.getElementById('newTaskProject').value);
        
        if (!taskName || !projectId) {
            showToast('Unesite naziv zadatka i odaberite projekt!', 'warning');
            return;
        }
        
        const project = projects.find(p => p.id === projectId);
        if (!project) {
            showToast('Projekt nije pronađen!', 'error');
            return;
        }
        
        if (!calendarEvents[selectedDayForCalendar]) {
            calendarEvents[selectedDayForCalendar] = [];
        }
        
        calendarEvents[selectedDayForCalendar].push({
            name: taskName,
            projectId: projectId,
            projectName: project.name,
            type: 'task'
        });
        
        // Update UI
        openCalendarDayModal(selectedDayForCalendar, parseInt(selectedDayForCalendar.split('-')[2]));
        
        // Clear form
        document.getElementById('newTaskName').value = '';
        document.getElementById('newTaskProject').value = '';
        
        showToast(`Zadatak "${taskName}" dodan za ${selectedDayForCalendar}!`, 'success');
    }

    // Edit calendar task (placeholder function)
    function editCalendarTask(dateStr, projectId, type) {
        showToast('Uređivanje zadatka...', 'info');
    }
</script>
</body>
</html>